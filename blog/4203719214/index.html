<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="referrer" content="no-referrer">

    <meta name="author" content="Zachary Block">


    <meta name="subtitle" content="这里是副标题">




<title>Docker 入门 | Zachary Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    
    <script src="/js/jquery.min.js"></script>
    



    
    
        
    





    <script>
    function searchToggle() {
        const width = $(document.body).width()
        if(width > 479) {
            return;
        }
        const search = $('.search');
        const searchForm = $('.form-search')

        if(!search.hasClass("mobile-search")) {
            search.addClass("mobile-search");
        } else {
            search.removeClass("mobile-search");
        } 
    }

    function search(searchInputEl, formEl, flag) {
        const path = "/" + "search.json"; // 可以在public 下查看这个search.json
        $(formEl).submit(function(e){
            e.preventDefault();
            let target = null
            if(searchInputEl == null) {
                const screenWidth = $(document.body).width();
                target = screenWidth > 479 ? $('#pc-search-input') : $('#mobile-search-input');
                console.log(target);
            } else {
                target = $(searchInputEl)
            }

            if(!flag && target.val() === '') {
                return ;
            }

            $("#u-search").fadeIn(500, function() {
                $("body > .wrapper").addClass("modal-active");

                $.ajax({
                    url: path,
                    dataType: "json",
                    beforeSend: function (xhr) {
                        $input = target.val();
                        $(".form-input").val($input);
                        const loadingBar = $('.search-loading-bar') 
                        loadingBar.css({
                            width:'100%',
                            display: 'block'
                        });
                    },
                    success: function( datas ) {
                        // console.log(datas);
                        const $resultPanel = $(".modal-body")[0];
                        let str = `<ul class="modal-results">`;
                        var keywords = $(".form-input").val().trim().toLowerCase().split(/[\s\-]+/);
                        $resultPanel.innerHTML = "";
                        let hasResult = false
                        let text = `<div class="no-result">找不到与关键词相关的内容....</div>`;

                        if ($(".form-input").val().trim().length <= 0) {
                            // 没有结果
                            $resultPanel.innerHTML = text;
                            return;
                        }
                        datas.forEach(function (data) {
                            var isMatch = true;
                            if (!data.title || data.title.trim() === '') {
                                data.title = "Untitled";
                            }
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty contents
                            if (data_content !== '') {
                                keywords.forEach(function (keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);

                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        hasResult = true
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            } else {
                                isMatch = false;
                            }
                            // show search results
                            if (isMatch) {
                                str += `<li class='result-item'><a href='${data_url}' class='result-item-detail'> <span class="title">${data_title}</span>`;
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 200 characters
                                    var start = first_occur - 40;
                                    var end = first_occur + 160;

                                    if (start < 0) {
                                        start = 0;
                                    }

                                    if (start == 0) {
                                        end = 200;
                                    }

                                    if (end > content.length) {
                                        end = content.length;
                                    }

                                    var match_content = content.substring(start, end);

                                    // highlight all keywords
                                    keywords.forEach(function (keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, `<em class="search-keyword">${keyword}</em>`);
                                    });

                                    str += `<span class="content"> ${match_content} ...</span></a>`;
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        if(hasResult) {
                            $resultPanel.innerHTML = str;
                        } else {
                            $resultPanel.innerHTML = text;
                        }

                    },
                    complete: function() {
                        setTimeout(() => {
                                const loadingBar = $('.search-loading-bar') 
                                loadingBar.css({
                                    width:'0%',
                                    display: 'none'
                                });
                        }, 300)
                    }
                });
            })

        });
    }

    $(document).ready(function() {
        $('.modal-close').click(function () { 
            $("#u-search").fadeOut();
            $("body > .wrapper").removeClass("modal-active")
        })

        $('.modal-overlay').click(function() {
            $("#u-search").fadeOut();
            $("body > .wrapper").removeClass("modal-active")
        })
        search(null, ".form-search", false)
        search("#u-search-modal-form .form-input", ".u-search-modal-form", true)
    })
</script>

<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Zachary Blog" type="application/atom+xml">
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Zachary&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                
    <div class="search ">
        <div class="search-btn" onClick="searchToggle()">
            <!-- <img src="/" class="search-btn-img" /> -->
            <i class="iconfont icon-search " ></i>
        </div>
        <form class="form-search">
            <input class="input" placeholder="搜索内容" autocomplete="off" id="pc-search-input"/>
        </form>
    </div>

                
                    <a class="menu-item" href="/archives">归档</a>
                
                    <a class="menu-item" href="/category">分类</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Zachary&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="navbar-mobile-right">
                    
                    
    <div class="search ">
        <div class="search-btn" onClick="searchToggle()">
            <!-- <img src="/" class="search-btn-img" /> -->
            <i class="iconfont icon-search " ></i>
        </div>
        <form class="form-search">
            <input class="input" placeholder="搜索内容" autocomplete="off" id="mobile-search-input"/>
        </form>
    </div>

                    <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
                </div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">归档</a>
                
                    <a class="menu-item" href="/category">分类</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">Docker 入门</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Zachary Block</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">1 月 23 日&nbsp;&nbsp;6:44:00</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Docker/">Docker</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Docker-入门"><a href="#Docker-入门" class="headerlink" title="Docker 入门"></a>Docker 入门</h1><h1 id="初识-Docker"><a href="#初识-Docker" class="headerlink" title="初识 Docker"></a>初识 Docker</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>虚拟机的出现使得 同一台物理机上实现多个操作系统（OS）运行不同 App 达到目的 成为可能</p>
<p>但是当虚拟机数量越来越多 或者所运行的 App 消耗的资源越来越大时 对物理机会产生极大消耗</p>
<p>为了使得系统性能不被多个虚拟机中的 OS 所消耗，容器技术（Container）应运而生</p>
<p>与虚拟机不同，容器技术依赖容器支持层，创建多个容器，用以运行多个 App</p>
<p>优点是极大地降低了资源消耗，同时形成多个虚拟机的效果，其中最流行的容器技术就是 Docker</p>
<h2 id="Docker-的特点"><a href="#Docker-的特点" class="headerlink" title="Docker 的特点"></a>Docker 的特点</h2><ul>
<li>基于 Linux 实现的虚拟技术</li>
<li>依据进程隔离实现的</li>
<li>体积小、占用资源少</li>
<li>启动快</li>
</ul>
<h2 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h2><ul>
<li>用于解决软件开发中的环境配置，作用类似于 Python 的虚拟环境</li>
</ul>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ul>
<li>MacOS 系统访问 <a target="_blank" rel="noopener" href="https://docs.docker.com/desktop/install/mac-install/">https://docs.docker.com/desktop/install/mac-install/</a></li>
<li>Windows 系统访问 <a target="_blank" rel="noopener" href="https://docs.docker.com/desktop/install/windows-install/">https://docs.docker.com/desktop/install/windows-install/</a></li>
<li>ubuntu 系统访问 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></li>
<li>centos 系统访问 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></li>
<li>显示 docker 版本 <code>docker -v</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu<span class="literal">-server</span>:~<span class="comment"># docker -v</span></span><br><span class="line">Docker version <span class="number">24.0</span>.<span class="number">6</span>, build ed223bc</span><br></pre></td></tr></table></figure>

<ul>
<li>显示 docker 详细信息 <code>docker info</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:/# docker info</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:    24.0.6</span><br><span class="line"> Context:    default</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Plugins:</span><br><span class="line">  buildx: Docker Buildx (Docker Inc.)</span><br><span class="line">    Version:  v0.11.2</span><br><span class="line">    Path:     /usr/libexec/docker/cli-plugins/docker-buildx</span><br><span class="line">  compose: Docker Compose (Docker Inc.)</span><br><span class="line">    Version:  v2.21.0</span><br><span class="line">    Path:     /usr/libexec/docker/cli-plugins/docker-compose</span><br></pre></td></tr></table></figure>

<ul>
<li>查看 docker 运行状态 <code>systemctl status docker</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# systemctl status docker</span><br><span class="line">● docker.service - Docker Application Container Engine</span><br><span class="line">     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: active (running) since Thu 2023-10-05 00:59:25 UTC; 3 months 18 days ago</span><br><span class="line">TriggeredBy: ● docker.socket</span><br><span class="line">       Docs: https://docs.docker.com</span><br><span class="line">   Main PID: 1049 (dockerd)</span><br><span class="line">      Tasks: 10</span><br><span class="line">     Memory: 277.2M</span><br><span class="line">     CGroup: /system.slice/docker.service</span><br><span class="line">             └─1049 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line"></span><br><span class="line">Oct 05 00:59:25 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T00:59:25.580102143Z&quot; level=info msg=&quot;API listen&gt;</span><br><span class="line">Oct 05 00:59:25 ubuntu-server systemd[1]: Started Docker Application Container Engine.</span><br><span class="line">Oct 05 01:17:12 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T01:17:12.301687748Z&quot; level=info msg=&quot;ignoring e&gt;</span><br><span class="line">Oct 05 01:17:12 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T01:17:12.322715268Z&quot; level=warning msg=&quot;failed &gt;</span><br><span class="line">Oct 05 01:24:34 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T01:24:34.725731365Z&quot; level=error msg=&quot;stream co&gt;</span><br><span class="line">Oct 05 01:24:34 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T01:24:34.725833604Z&quot; level=error msg=&quot;stream co&gt;</span><br><span class="line">Oct 05 01:24:59 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T01:24:59.217576662Z&quot; level=error msg=&quot;Not conti&gt;</span><br><span class="line">Oct 05 02:09:18 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T02:09:18.848121719Z&quot; level=info msg=&quot;Container &gt;</span><br><span class="line">Oct 05 02:09:18 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T02:09:18.883004570Z&quot; level=info msg=&quot;ignoring e&gt;</span><br><span class="line">Oct 05 02:09:18 ubuntu-server dockerd[1049]: time=&quot;2023-10-05T02:09:18.900091164Z&quot; level=warning msg=&quot;failed &gt;</span><br><span class="line">lines 1-21/21 (END)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1705967489620-0fd61fae-3fed-47cc-8029-66a8d8ed29be.png"></p>
<ul>
<li>设置 docker 开机自启动 <code>systemctl enable docker</code></li>
</ul>
<h1 id="Docker-运行"><a href="#Docker-运行" class="headerlink" title="Docker 运行"></a>Docker 运行</h1><p>最初，刚安装好 docker 的机器不存在镜像因此没办法运行</p>
<p>运行<code>docker run hello-world</code>的效果如下，由于设备上还没有拉取任何镜像，因此是从 library 上拉取的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run hello-world</span><br><span class="line">Unable to find image &#x27;hello-world:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">c1ec31eb5944: Pull complete</span><br><span class="line">Digest: sha256:4bd78111b6914a99dbc560e6a20eab57ff6655aea4a80c50b0c5491968cbc2e6</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta prompt_"> $ </span><span class="language-bash">docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br></pre></td></tr></table></figure>

<h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><ul>
<li><code>docker run [镜像名称]</code>，若该镜像不存在 则会默认拉取最新的</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run nginx</span><br><span class="line">Unable to find image &#x27;nginx:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">2f44b7a888fa: Pull complete</span><br><span class="line">8b7dd3ed1dc3: Pull complete</span><br><span class="line">35497dd96569: Pull complete</span><br><span class="line">36664b6ce66b: Pull complete</span><br><span class="line">2d455521f76c: Pull complete</span><br><span class="line">dc9c4fdb83d6: Pull complete</span><br><span class="line">8056d2bcf3b6: Pull complete</span><br><span class="line">Digest: sha256:4c0fdaa8b6341bfdeca5f18f7837462c80cff90527ee35ef185571e1c327beac</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2024/01/23 13:58:44 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class="line">2024/01/23 13:58:44 [notice] 1#1: nginx/1.25.3</span><br><span class="line">2024/01/23 13:58:44 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14)</span><br><span class="line">2024/01/23 13:58:44 [notice] 1#1: OS: Linux 5.4.0-163-generic</span><br><span class="line">2024/01/23 13:58:44 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2024/01/23 13:58:44 [notice] 1#1: start worker processes</span><br><span class="line">2024/01/23 13:58:44 [notice] 1#1: start worker process 28</span><br><span class="line">2024/01/23 13:58:44 [notice] 1#1: start worker process 29</span><br><span class="line">2024/01/23 14:01:05 [notice] 1#1: signal 28 (SIGWINCH) received</span><br><span class="line">2024/01/23 14:01:06 [notice] 1#1: signal 28 (SIGWINCH) received</span><br><span class="line">2024/01/23 14:01:06 [notice] 1#1: signal 28 (SIGWINCH) received</span><br><span class="line">2024/01/23 14:01:06 [notice] 1#1: signal 28 (SIGWINCH) received</span><br><span class="line">2024/01/23 14:01:07 [notice] 1#1: signal 28 (SIGWINCH) received</span><br><span class="line">2024/01/23 14:01:07 [notice] 1#1: signal 28 (SIGWINCH) received</span><br><span class="line">2024/01/23 14:01:08 [notice] 1#1: signal 28 (SIGWINCH) received</span><br><span class="line">2024/01/23 14:01:09 [notice] 1#1: signal 28 (SIGWINCH) received</span><br><span class="line">2024/01/23 14:01:09 [notice] 1#1: signal 28 (SIGWINCH) received</span><br></pre></td></tr></table></figure>

<p>会启动一个 nginx 服务，并且等待着</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706018523068-dbaa31b5-7044-4fe9-a99e-51a2500a82b5.png"></p>
<h2 id="查看当前容器"><a href="#查看当前容器" class="headerlink" title="查看当前容器"></a>查看当前容器</h2><ul>
<li><code>docker ps</code> 查看正在运行中的或者创建了的容器</li>
<li><code>docker ps -a</code> 查看所有容器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br><span class="line">8e1148f9c025   nginx     &quot;/docker-entrypoint.…&quot;   6 minutes ago   Up 6 minutes   80/tcp    reverent_wozniak</span><br><span class="line">root@ubuntu-server:~#</span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">8e1148f9c025   nginx         &quot;/docker-entrypoint.…&quot;   6 minutes ago    Up 6 minutes                80/tcp    reverent_wozniak</span><br><span class="line">2d987d559739   hello-world   &quot;/hello&quot;                 30 minutes ago   Exited (0) 30 minutes ago             loving_lehmann</span><br><span class="line">root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<ul>
<li><code>docker inspect [容器ID]</code>，查看容器的信息</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker inspect 8e1148f9c025</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;8e1148f9c02527e90a80ca1f783404ffeb0b22e87a7d3331fef40354ca237c80&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2024-01-23T13:58:44.354388314Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;nginx&quot;,</span><br><span class="line">            &quot;-g&quot;,</span><br><span class="line">            &quot;daemon off;&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 60563,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2024-01-23T13:58:44.664498639Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:a8758716bb6aa4d90071160d27028fe4eaee7ce8166221a97d30440c8eac2be6&quot;,</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706018930511-d164a632-ad95-4f73-95b4-f2bd9036a1ce.png"></p>
<ul>
<li><code>curl http://[IpAddress]:[Ports]</code>访问该 nginx 服务</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# curl http://172.17.0.2:80</span><br><span class="line">curl: (7) Failed to connect to 172.17.0.2 port 80: Connection refused</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# curl http://127.0.0.1:80</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>这时候 我出现了一个问题，通过 IPAddress 访问不到，但是通过容器内部可以访问到，并且 ping 不通 172.17.0.2，解决方法如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:/# cd /etc/docker/</span><br><span class="line">root@ubuntu-server:/etc/docker# nano daemon.json</span><br><span class="line">root@ubuntu-server:/etc/docker# cat daemon.json</span><br><span class="line">&#123;</span><br><span class="line"> &quot;bip&quot;:&quot;172.17.0.1/24&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:/etc/docker# ps -ef | grep dockerd</span><br><span class="line">root       66939   64105  0 15:14 pts/0    00:00:00 dockerd</span><br><span class="line">root       67596   64105  0 15:21 pts/0    00:00:00 grep --color=auto dockerd</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:/etc/docker# kill -9 66939</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:/etc/docker# sudo systemctl stop docker &amp;&amp; sudo systemctl disable docker</span><br><span class="line">Warning: Stopping docker.service, but it can still be activated by:</span><br><span class="line">  docker.socket</span><br><span class="line">[1]+  Killed                  dockerd</span><br><span class="line">Synchronizing state of docker.service with SysV service script with /lib/systemd/systemd-sysv-install.</span><br><span class="line">Executing: /lib/systemd/systemd-sysv-install disable docker</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:/etc/docker# ip link set dev docker0 down</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# dockerd &amp;</span><br><span class="line">[2] 68637</span><br><span class="line">root@ubuntu-server:~# INFO[2024-01-23T15:28:54.176224866Z] Starting up</span><br><span class="line">INFO[2024-01-23T15:28:54.177656625Z] detected 127.0.0.53 nameserver, assuming systemd-resolved, so using resolv.conf: /run/systemd/resolve/resolv.conf</span><br><span class="line">INFO[2024-01-23T15:28:54.205339444Z] [graphdriver] using prior storage driver: overlay2</span><br><span class="line">INFO[2024-01-23T15:28:54.207603223Z] Loading containers: start.</span><br><span class="line">INFO[2024-01-23T15:28:54.420248892Z] Loading containers: done.</span><br><span class="line">WARN[2024-01-23T15:28:54.435812794Z] WARNING: No swap limit support</span><br><span class="line">INFO[2024-01-23T15:28:54.436013678Z] Docker daemon                                 commit=1a79695 graphdriver=overlay2 version=24.0.6</span><br><span class="line">INFO[2024-01-23T15:28:54.436353042Z] Daemon has completed initialization</span><br><span class="line">INFO[2024-01-23T15:28:54.462870900Z] API listen on /var/run/docker.sock</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# ps -ef | grep dockerd</span><br><span class="line">root       68637   64105  0 15:28 pts/0    00:00:00 dockerd</span><br><span class="line">root       68836   64105  0 15:30 pts/0    00:00:00 grep --color=auto dockerd</span><br></pre></td></tr></table></figure>

<p>之后尝试重新创建一个 nginx 容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run nginx</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: nginx/1.25.3</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14)</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: OS: Linux 5.4.0-163-generic</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: start worker processes</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: start worker process 29</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: start worker process 30</span><br></pre></td></tr></table></figure>

<p>然后使用<code>curl http://172.17.0.2:80</code>运行一下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS                   PORTS     NAMES</span><br><span class="line">9db02b830360   nginx         &quot;/docker-entrypoint.…&quot;   11 seconds ago   Up 10 seconds            80/tcp    heuristic_swanson</span><br><span class="line">2d987d559739   hello-world   &quot;/hello&quot;                 2 hours ago      Exited (0) 2 hours ago             loving_lehmann</span><br><span class="line">root@ubuntu-server:~# docker inspect 9db02b830360</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;9db02b830360af059797b0b17c9fb043c46d468aa9d4ac7edd4e1dbb0bcc5536&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2024-01-23T15:31:01.321227908Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;nginx&quot;,</span><br><span class="line">            &quot;-g&quot;,</span><br><span class="line">            &quot;daemon off;&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 68908,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2024-01-23T15:31:01.62045826Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:a8758716bb6aa4d90071160d27028fe4eaee7ce8166221a97d30440c8eac2be6&quot;,</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# curl http://172.17.0.2:80</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>并且在另一边的 nginx 服务上可以看到访问</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run nginx</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: nginx/1.25.3</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14)</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: OS: Linux 5.4.0-163-generic</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: start worker processes</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: start worker process 29</span><br><span class="line">2024/01/23 15:31:01 [notice] 1#1: start worker process 30</span><br><span class="line">172.17.0.1 - - [23/Jan/2024:15:31:41 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.68.0&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure>

<h2 id="停止与删除容器"><a href="#停止与删除容器" class="headerlink" title="停止与删除容器"></a>停止与删除容器</h2><ul>
<li><code>docker stop [容器ID]</code> 停止一个容器</li>
<li><code>docker &lt;container&gt; rm [容器ID]/[容器名:Tag]</code> 删除一个容器，一个容器必须先停止了 才能被删除</li>
<li><code>docker run --rm [容器名称]</code>创建一个容器，容器停止时自动删除</li>
<li><code>docker container prune</code>删除所有已经停止的容器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED             STATUS                   PORTS     NAMES</span><br><span class="line">9db02b830360   nginx         &quot;/docker-entrypoint.…&quot;   About an hour ago   Up About an hour         80/tcp    heuristic_swanson</span><br><span class="line">2d987d559739   hello-world   &quot;/hello&quot;                 3 hours ago         Exited (0) 3 hours ago             loving_lehmann</span><br><span class="line">root@ubuntu-server:~# docker stop 9db02b830360</span><br><span class="line">9db02b830360</span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED             STATUS                     PORTS     NAMES</span><br><span class="line">9db02b830360   nginx         &quot;/docker-entrypoint.…&quot;   About an hour ago   Exited (0) 3 seconds ago             heuristic_swanson</span><br><span class="line">2d987d559739   hello-world   &quot;/hello&quot;                 3 hours ago         Exited (0) 3 hours ago               loving_lehmann</span><br><span class="line">root@ubuntu-server:~# docker rm 9db02b830360</span><br><span class="line">9db02b830360</span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND    CREATED       STATUS                   PORTS     NAMES</span><br><span class="line">2d987d559739   hello-world   &quot;/hello&quot;   3 hours ago   Exited (0) 3 hours ago             loving_lehmann</span><br><span class="line">root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<h2 id="启动指定-Image-版本容器"><a href="#启动指定-Image-版本容器" class="headerlink" title="启动指定 Image 版本容器"></a>启动指定 Image 版本容器</h2><ul>
<li><code>docker run [镜像名称]</code> 默认表示最新版本的镜像</li>
<li><code>docker run [镜像名称]:[版本号]</code> 使用版本号指定的镜像</li>
<li>查看官方维护的镜像版本号 <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706029729611-bde303ab-bc84-44e6-a420-4a91876a2332.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run nginx:1.24.0</span><br><span class="line">Unable to find image &#x27;nginx:1.24.0&#x27; locally</span><br><span class="line">1.24.0: Pulling from library/nginx</span><br><span class="line">0e0969fcaa82: Pull complete</span><br><span class="line">9cfddd3151d4: Pull complete</span><br><span class="line">0a14c9c58a70: Pull complete</span><br><span class="line">46aff079cc60: Pull complete</span><br><span class="line">93498c6629aa: Pull complete</span><br><span class="line">a67e21d7eabc: Pull complete</span><br><span class="line">Digest: sha256:401bc2c812345a6c64a0fd5504db5e8b511c7c8e62855a827c57944280835703</span><br><span class="line">Status: Downloaded newer image for nginx:1.24.0</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2024/01/23 17:10:12 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class="line">2024/01/23 17:10:12 [notice] 1#1: nginx/1.24.0</span><br><span class="line">2024/01/23 17:10:12 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6)</span><br><span class="line">2024/01/23 17:10:12 [notice] 1#1: OS: Linux 5.4.0-163-generic</span><br><span class="line">2024/01/23 17:10:12 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2024/01/23 17:10:12 [notice] 1#1: start worker processes</span><br><span class="line">2024/01/23 17:10:12 [notice] 1#1: start worker process 29</span><br><span class="line">2024/01/23 17:10:12 [notice] 1#1: start worker process 30</span><br></pre></td></tr></table></figure>

<p>其他的一些操作比如容器的停止与删除等都与之前一致</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# curl http://172.17.0.2:80</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED         STATUS                   PORTS     NAMES</span><br><span class="line">b29d1d06802e   nginx:1.24.0   &quot;/docker-entrypoint.…&quot;   4 minutes ago   Up 4 minutes             80/tcp    eloquent_bartik</span><br><span class="line">2d987d559739   hello-world    &quot;/hello&quot;                 4 hours ago     Exited (0) 4 hours ago             loving_lehmann</span><br><span class="line">root@ubuntu-server:~# docker rm b29d1d06802e</span><br><span class="line">Error response from daemon: You cannot remove a running container b29d1d06802ef51cf29a0f2fcf966f5b0b98f2d10781fe9a6b73663e2e001e08. Stop the container before attempting removal or force remove</span><br><span class="line">root@ubuntu-server:~# docker stop b29d1d06802e</span><br><span class="line">INFO[2024-01-23T17:14:43.920238667Z] ignoring event                                container=b29d1d06802ef51cf29a0f2fcf966f5b0b98f2d10781fe9a6b73663e2e001e08 module=libcontainerd namespace=moby topic=/tasks/delete type=&quot;*events.TaskDelete&quot;</span><br><span class="line">b29d1d06802e</span><br><span class="line">root@ubuntu-server:~# docker rm b29d1d06802e</span><br><span class="line">b29d1d06802e</span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND    CREATED       STATUS                   PORTS     NAMES</span><br><span class="line">2d987d559739   hello-world   &quot;/hello&quot;   4 hours ago   Exited (0) 4 hours ago             loving_lehmann</span><br></pre></td></tr></table></figure>

<h2 id="创建交互式终端容器"><a href="#创建交互式终端容器" class="headerlink" title="创建交互式终端容器"></a>创建交互式终端容器</h2><ul>
<li><code>docker run -it &lt;--name=[容器名称]&gt; [镜像名称]&lt;:[版本号]&gt;</code> 启动后可在控制台打印输出与获取输入</li>
<li><code>docker run -it &lt;--name=[容器名称]&gt; [镜像名称]&lt;:[版本号]&gt; bash</code> 启动后直接进入交互终端</li>
<li><code>exit</code>退出交互式终端</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -it --name=nginx_test1 nginx</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2024/01/23 18:20:15 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class="line">2024/01/23 18:20:15 [notice] 1#1: nginx/1.25.3</span><br><span class="line">2024/01/23 18:20:15 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14)</span><br><span class="line">2024/01/23 18:20:15 [notice] 1#1: OS: Linux 5.4.0-163-generic</span><br><span class="line">2024/01/23 18:20:15 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2024/01/23 18:20:15 [notice] 1#1: start worker processes</span><br><span class="line">2024/01/23 18:20:15 [notice] 1#1: start worker process 29</span><br><span class="line">2024/01/23 18:20:15 [notice] 1#1: start worker process 30</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS                   PORTS     NAMES</span><br><span class="line">550565930a6a   nginx         &quot;/docker-entrypoint.…&quot;   16 seconds ago   Up 15 seconds            80/tcp    nginx_test1</span><br><span class="line">2d987d559739   hello-world   &quot;/hello&quot;                 5 hours ago      Exited (0) 5 hours ago             loving_lehmann</span><br><span class="line">root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS                   PORTS     NAMES</span><br><span class="line">550565930a6a   nginx         &quot;/docker-entrypoint.…&quot;   16 seconds ago   Up 15 seconds            80/tcp    nginx_test1</span><br><span class="line">2d987d559739   hello-world   &quot;/hello&quot;                 5 hours ago      Exited (0) 5 hours ago             loving_lehmann</span><br><span class="line">root@ubuntu-server:~# docker run -it --name=nginx_test_bash nginx:1.24.0 bash</span><br><span class="line">root@9dd09b818936:/# ll</span><br><span class="line">bash: ll: command not found</span><br><span class="line">root@9dd09b818936:/# ls</span><br><span class="line">bin   dev		   docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  docker-entrypoint.d  etc			 lib   media  opt  root  sbin  sys  usr</span><br><span class="line">root@9dd09b818936:/# ls -l</span><br><span class="line">total 72</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jan 10 00:00 bin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Sep 29 20:00 boot</span><br><span class="line">drwxr-xr-x   5 root root  360 Jan 23 18:22 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jan 12 00:22 docker-entrypoint.d</span><br><span class="line">-rwxr-xr-x   1 root root 1616 Jan 12 00:21 docker-entrypoint.sh</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jan 23 18:22 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 Sep 29 20:00 home</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jan 10 00:00 lib</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jan 10 00:00 lib64</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jan 10 00:00 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jan 10 00:00 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jan 10 00:00 opt</span><br><span class="line">dr-xr-xr-x 291 root root    0 Jan 23 18:22 proc</span><br><span class="line">drwx------   2 root root 4096 Jan 10 00:00 root</span><br><span class="line">drwxr-xr-x   3 root root 4096 Jan 10 00:00 run</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jan 10 00:00 sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Jan 10 00:00 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 Jan 23 18:22 sys</span><br><span class="line">drwxrwxrwt   2 root root 4096 Jan 10 00:00 tmp</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jan 10 00:00 usr</span><br><span class="line">drwxr-xr-x   1 root root 4096 Jan 10 00:00 var</span><br><span class="line">root@9dd09b818936:/# docker ps -a</span><br><span class="line">bash: docker: command not found</span><br><span class="line">root@9dd09b818936:/# exit</span><br><span class="line">exit</span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED              STATUS                       PORTS     NAMES</span><br><span class="line">9dd09b818936   nginx:1.24.0   &quot;/docker-entrypoint.…&quot;   About a minute ago   Exited (127) 7 seconds ago             nginx_test_bash</span><br><span class="line">550565930a6a   nginx          &quot;/docker-entrypoint.…&quot;   3 minutes ago        Up 3 minutes                 80/tcp    nginx_test1</span><br><span class="line">2d987d559739   hello-world    &quot;/hello&quot;                 5 hours ago          Exited (0) 5 hours ago                 loving_lehmann</span><br><span class="line">root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<h2 id="启动映射端口的容器"><a href="#启动映射端口的容器" class="headerlink" title="启动映射端口的容器"></a>启动映射端口的容器</h2><p>如果想要实现通过主机 ip 对 docker 的服务进行访问 需要执行端口映射</p>
<ul>
<li><code>docker run -p [主机端口]:[容器端口] [镜像名称]&lt;:[版本号]&gt;</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -p 8089:80 nginx</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2024/01/23 18:38:34 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class="line">2024/01/23 18:38:34 [notice] 1#1: nginx/1.25.3</span><br><span class="line">2024/01/23 18:38:34 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14)</span><br><span class="line">2024/01/23 18:38:34 [notice] 1#1: OS: Linux 5.4.0-163-generic</span><br><span class="line">2024/01/23 18:38:34 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2024/01/23 18:38:34 [notice] 1#1: start worker processes</span><br><span class="line">2024/01/23 18:38:34 [notice] 1#1: start worker process 29</span><br><span class="line">2024/01/23 18:38:34 [notice] 1#1: start worker process 30</span><br></pre></td></tr></table></figure>

<p>然后获取主机的 ip 地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# ifconfig</span><br><span class="line">docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.1  netmask 255.255.255.0  broadcast 172.17.0.255</span><br><span class="line">        inet6 fe80::42:a1ff:fe46:815b  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 02:42:a1:46:81:5b  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 28  bytes 4708 (4.7 KB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 86  bytes 7509 (7.5 KB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.7.128  netmask 255.255.255.0  broadcast 192.168.7.255</span><br><span class="line">        inet6 fe80::20c:29ff:fe88:f308  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:88:f3:08  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 543109  bytes 789811793 (789.8 MB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 45005  bytes 3778306 (3.7 MB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>

<p>之后在浏览器通过访问主机 ip 地址+port 端口号 (192.168.7.128:8089)，访问刚才启动的 nginx 服务</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706035310119-2333c619-de03-4fa4-8e19-0d7ec7603028.png"></p>
<h2 id="启动容器时配置环境变量"><a href="#启动容器时配置环境变量" class="headerlink" title="启动容器时配置环境变量"></a>启动容器时配置环境变量</h2><ul>
<li><code>docker run mysql</code>启动一个 MySQL 容器</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run mysql</span><br><span class="line">Unable to find image &#x27;mysql:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">558b7d69a2e5: Pull complete</span><br><span class="line">2cb5a921059e: Pull complete</span><br><span class="line">b85878fb9bb2: Pull complete</span><br><span class="line">d16f3fd26a82: Pull complete</span><br><span class="line">afd51b5329cb: Pull complete</span><br><span class="line">374d2f7f3267: Pull complete</span><br><span class="line">4ea1bb2c9574: Pull complete</span><br><span class="line">1c9054053605: Pull complete</span><br><span class="line">d79cd2da03be: Pull complete</span><br><span class="line">e3a1aa788d17: Pull complete</span><br><span class="line">Digest: sha256:d7c20c5ba268c558f4fac62977f8c7125bde0630ff8946b08dde44135ef40df3</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">2024-01-23 18:45:20+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">2024-01-23 18:45:21+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class="line">2024-01-23 18:45:21+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">2024-01-23 18:45:21+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified</span><br><span class="line">    You need to specify one of the following as an environment variable:</span><br><span class="line">    - MYSQL_ROOT_PASSWORD</span><br><span class="line">    - MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">    - MYSQL_RANDOM_ROOT_PASSWORD</span><br></pre></td></tr></table></figure>

<p>提示需要执行以下任意一个命令</p>
<blockquote>
<p>You need to specify one of the following as an environment variable:</p>
</blockquote>
<ul>
<li>MYSQL_ROOT_PASSWORD</li>
<li>MYSQL_ALLOW_EMPTY_PASSWORD</li>
<li>MYSQL_RANDOM_ROOT_PASSWORD<blockquote>
</blockquote>
</li>
</ul>
<p>这时候如果可以实现在启动容器的时候 就配置上环境变量，就可以实现</p>
<ul>
<li><code>docker run -e [变量名]=[变量值] [镜像名称]</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -e MYSQL_ROOT_PASSWORD=123456 mysql</span><br><span class="line">2024-01-23 18:49:31+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">2024-01-23 18:49:31+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class="line">2024-01-23 18:49:31+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">2024-01-23 18:49:31+00:00 [Note] [Entrypoint]: Initializing database files</span><br><span class="line">2024-01-23T18:49:31.790608Z 0 [System] [MY-015017] [Server] MySQL Server Initialization - start.</span><br><span class="line">2024-01-23T18:49:31.792861Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.3.0) initializing of server in progress as process 78</span><br><span class="line">2024-01-23T18:49:31.801893Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2024-01-23T18:49:33.124408Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">2024-01-23T18:49:34.643504Z 6 [Warning] [MY-010453] [Server] root@localhost is created with an empty password ! Please consider switching off the --initialize-insecure option.</span><br><span class="line">2024-01-23T18:49:37.095006Z 0 [System] [MY-015018] [Server] MySQL Server Initialization - end.</span><br><span class="line">2024-01-23 18:49:37+00:00 [Note] [Entrypoint]: Database files initialized</span><br><span class="line">2024-01-23 18:49:37+00:00 [Note] [Entrypoint]: Starting temporary server</span><br><span class="line">2024-01-23T18:49:37.178985Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class="line">2024-01-23T18:49:37.938518Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.3.0) starting as process 120</span><br><span class="line">2024-01-23T18:49:37.984832Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2024-01-23T18:49:38.618882Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">2024-01-23T18:49:39.139280Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class="line">2024-01-23T18:49:39.139356Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class="line">2024-01-23T18:49:39.142832Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location &#x27;/var/run/mysqld&#x27; in the path is accessible to all OS users. Consider choosing a different directory.</span><br><span class="line">2024-01-23T18:49:39.222585Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Socket: /var/run/mysqld/mysqlx.sock</span><br><span class="line">2024-01-23T18:49:39.236461Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: &#x27;8.3.0&#x27;  socket: &#x27;/var/run/mysqld/mysqld.sock&#x27;  port: 0  MySQL Community Server - GPL.</span><br><span class="line">2024-01-23 18:49:39+00:00 [Note] [Entrypoint]: Temporary server started.</span><br><span class="line">&#x27;/var/lib/mysql/mysql.sock&#x27; -&gt; &#x27;/var/run/mysqld/mysqld.sock&#x27;</span><br><span class="line">Warning: Unable to load &#x27;/usr/share/zoneinfo/iso3166.tab&#x27; as time zone. Skipping it.</span><br><span class="line">Warning: Unable to load &#x27;/usr/share/zoneinfo/leap-seconds.list&#x27; as time zone. Skipping it.</span><br><span class="line">Warning: Unable to load &#x27;/usr/share/zoneinfo/leapseconds&#x27; as time zone. Skipping it.</span><br><span class="line">Warning: Unable to load &#x27;/usr/share/zoneinfo/tzdata.zi&#x27; as time zone. Skipping it.</span><br><span class="line">Warning: Unable to load &#x27;/usr/share/zoneinfo/zone.tab&#x27; as time zone. Skipping it.</span><br><span class="line">Warning: Unable to load &#x27;/usr/share/zoneinfo/zone1970.tab&#x27; as time zone. Skipping it.</span><br><span class="line"></span><br><span class="line">2024-01-23 18:49:43+00:00 [Note] [Entrypoint]: Stopping temporary server</span><br><span class="line">2024-01-23T18:49:43.608667Z 10 [System] [MY-013172] [Server] Received SHUTDOWN from user root. Shutting down mysqld (Version: 8.3.0).</span><br><span class="line">2024-01-23T18:49:44.452345Z 0 [System] [MY-010910] [Server] /usr/sbin/mysqld: Shutdown complete (mysqld 8.3.0)  MySQL Community Server - GPL.</span><br><span class="line">2024-01-23T18:49:44.452374Z 0 [System] [MY-015016] [Server] MySQL Server - end.</span><br><span class="line">2024-01-23 18:49:44+00:00 [Note] [Entrypoint]: Temporary server stopped</span><br><span class="line"></span><br><span class="line">2024-01-23 18:49:44+00:00 [Note] [Entrypoint]: MySQL init process done. Ready for start up.</span><br><span class="line"></span><br><span class="line">2024-01-23T18:49:44.647019Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class="line">2024-01-23T18:49:44.932472Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.3.0) starting as process 1</span><br><span class="line">2024-01-23T18:49:44.939342Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">2024-01-23T18:49:45.096752Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">2024-01-23T18:49:45.319462Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class="line">2024-01-23T18:49:45.319508Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class="line">2024-01-23T18:49:45.321697Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location &#x27;/var/run/mysqld&#x27; in the path is accessible to all OS users. Consider choosing a different directory.</span><br><span class="line">2024-01-23T18:49:45.347896Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /var/run/mysqld/mysqlx.sock</span><br><span class="line">2024-01-23T18:49:45.348529Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: &#x27;8.3.0&#x27;  socket: &#x27;/var/run/mysqld/mysqld.sock&#x27;  port: 3306  MySQL Community Server - GPL.</span><br></pre></td></tr></table></figure>

<p>服务启动之后可以尝试连接一下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                 NAMES</span><br><span class="line">2edfbe0997f3   mysql     &quot;docker-entrypoint.s…&quot;   2 minutes ago   Up 2 minutes   3306/tcp, 33060/tcp   gallant_cori</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# docker inspect 2edfbe0997f3 | grep &quot;IPAddress&quot;</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# mysql -h 172.17.0.2 -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.3.0 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2023, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases</span></span><br><span class="line">    -&gt; ;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.01 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"></span></span><br></pre></td></tr></table></figure>

<h2 id="启动容器时配置路径映射"><a href="#启动容器时配置路径映射" class="headerlink" title="启动容器时配置路径映射"></a>启动容器时配置路径映射</h2><p>当 docker 中的一个 mysql 服务容器删除之后，之前在这个容器中创建的数据库、表都会消失掉；</p>
<p>那如果可以将主机的某个路径（磁盘卷）映射到容器中，使得数据库、表存储在主机中，就不会因为容器的删除而导致数据的丢失</p>
<ul>
<li><code>docker run -v [主机路径]:[容器路径] [镜像名称]</code>创建一个映射路径的容器</li>
</ul>
<p>先停掉之前的服务，然后创建 第一个 mysql 容器，然后在这个容器里面创建 一个数据库 之后删除掉这个容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -e MYSQL_ROOT_PASSWORD=123456 -v /opt/mysql:/var/lib/mysql mysql</span><br><span class="line">2024-01-23 19:09:44+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">2024-01-23 19:09:44+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class="line">2024-01-23 19:09:44+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">2024-01-23 19:09:44+00:00 [Note] [Entrypoint]: Initializing database files</span><br><span class="line">2024-01-23T19:09:44.568209Z 0 [System] [MY-015017] [Server] MySQL Server Initialization - start.</span><br><span class="line">2024-01-23T19:09:44.570481Z 0 [System] [MY-013169] [Server] /usr/sbin/mysqld (mysqld 8.3.0) initializing of server in progress as process 80</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS              PORTS                 NAMES</span><br><span class="line">96a607ba155f   mysql     &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute   3306/tcp, 33060/tcp   zen_newton</span><br><span class="line">root@ubuntu-server:~# mysql -h 172.17.0.2 -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.3.0 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2023, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create database db_in_opt;</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| db_in_opt          |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.01 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span></span></span><br><span class="line">Bye</span><br><span class="line">root@ubuntu-server:~# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                 NAMES</span><br><span class="line">96a607ba155f   mysql     &quot;docker-entrypoint.s…&quot;   3 minutes ago   Up 3 minutes   3306/tcp, 33060/tcp   zen_newton</span><br><span class="line">root@ubuntu-server:~# docker stop 96a607ba155f</span><br><span class="line">INFO[2024-01-23T19:12:59.513932769Z] ignoring event                                container=96a607ba155fb9f8095038725c3ecbc98aca97f8f2b85434790a50ce04e1d67e module=libcontainerd namespace=moby topic=/tasks/delete type=&quot;*events.TaskDelete&quot;</span><br><span class="line">96a607ba155f</span><br><span class="line">root@ubuntu-server:~# docker rm 96a607ba155f</span><br><span class="line">96a607ba155f</span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                        PORTS     NAMES</span><br><span class="line">2edfbe0997f3   mysql          &quot;docker-entrypoint.s…&quot;   23 minutes ago   Exited (0) 5 minutes ago                gallant_cori</span><br><span class="line">23c63d5c74d7   mysql          &quot;docker-entrypoint.s…&quot;   27 minutes ago   Exited (1) 27 minutes ago               trusting_mccarthy</span><br><span class="line">f67b48039737   nginx          &quot;/docker-entrypoint.…&quot;   34 minutes ago   Exited (0) 24 minutes ago               friendly_babbage</span><br><span class="line">9dd09b818936   nginx:1.24.0   &quot;/docker-entrypoint.…&quot;   50 minutes ago   Exited (127) 49 minutes ago             nginx_test_bash</span><br><span class="line">550565930a6a   nginx          &quot;/docker-entrypoint.…&quot;   52 minutes ago   Exited (0) 36 minutes ago               nginx_test1</span><br><span class="line">2d987d559739   hello-world    &quot;/hello&quot;                 6 hours ago      Exited (0) 6 hours ago                  loving_lehmann</span><br></pre></td></tr></table></figure>

<p>紧接着 再次执行 创建映射的 MySQL 容器 查看一下之前所创建的数据库是否存在</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -e MYSQL_ROOT_PASSWORD=123456 -v /opt/mysql:/var/lib/mysql mysql</span><br><span class="line">2024-01-23 19:14:55+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">2024-01-23 19:14:55+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class="line">2024-01-23 19:14:55+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">&#x27;/var/lib/mysql/mysql.sock&#x27; -&gt; &#x27;/var/run/mysqld/mysqld.sock&#x27;</span><br><span class="line">2024-01-23T19:14:55.912867Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                 NAMES</span><br><span class="line">98c3aba2809e   mysql     &quot;docker-entrypoint.s…&quot;   44 seconds ago   Up 44 seconds   3306/tcp, 33060/tcp   peaceful_moser</span><br><span class="line">root@ubuntu-server:~# mysql -h 172.17.0.2 -u root -p</span><br><span class="line">Enter password:</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 8</span><br><span class="line">Server version: 8.3.0 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2023, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| db_in_opt          |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h1 id="自定义-docker-Image-镜像"><a href="#自定义-docker-Image-镜像" class="headerlink" title="自定义 docker Image 镜像"></a>自定义 docker Image 镜像</h1><p>之前的操作都是在拉取官方的 image 运行的，若想实现一个自己的 image 需要如何操作</p>
<h2 id="查看已拉取镜像"><a href="#查看已拉取镜像" class="headerlink" title="查看已拉取镜像"></a>查看已拉取镜像</h2><ul>
<li><code>docker images</code></li>
<li><code>docker image ls</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker image ls</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mysql         latest    56b21e040954   5 days ago     632MB</span><br><span class="line">nginx         latest    a8758716bb6a   3 months ago   187MB</span><br><span class="line">hello-world   latest    d2c94e258dcb   8 months ago   13.3kB</span><br><span class="line">nginx         1.24.0    f373f7a623e7   9 months ago   142MB</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mysql         latest    56b21e040954   5 days ago     632MB</span><br><span class="line">nginx         latest    a8758716bb6a   3 months ago   187MB</span><br><span class="line">hello-world   latest    d2c94e258dcb   8 months ago   13.3kB</span><br><span class="line">nginx         1.24.0    f373f7a623e7   9 months ago   142MB</span><br></pre></td></tr></table></figure>

<h2 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h2><ul>
<li><code>docker pull [镜像名称image_name]&lt;:[版本号Tag]&gt;</code> 不指定版本号默认拉取最新版本</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker pull centos</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">a1d0c7532777: Pull complete</span><br><span class="line">Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177</span><br><span class="line">Status: Downloaded newer image for centos:latest</span><br><span class="line">docker.io/library/centos:latest</span><br><span class="line">root@ubuntu-server:~# docker pull centos:7</span><br><span class="line">7: Pulling from library/centos</span><br><span class="line">2d473b07cdd5: Pull complete</span><br><span class="line">Digest: sha256:be65f488b7764ad3638f236b7b515b3678369a5124c47b8d32916d6487418ea4</span><br><span class="line">Status: Downloaded newer image for centos:7</span><br><span class="line">docker.io/library/centos:7</span><br><span class="line">root@ubuntu-server:~# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mysql         latest    56b21e040954   5 days ago     632MB</span><br><span class="line">nginx         latest    a8758716bb6a   3 months ago   187MB</span><br><span class="line">hello-world   latest    d2c94e258dcb   8 months ago   13.3kB</span><br><span class="line">nginx         1.24.0    f373f7a623e7   9 months ago   142MB</span><br><span class="line">centos        7         eeb6ee3f44bd   2 years ago    204MB</span><br><span class="line">centos        latest    5d0da3dc9764   2 years ago    231MB</span><br></pre></td></tr></table></figure>

<h2 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h2><ul>
<li><code>docker image rm [镜像名称image_name]&lt;:[版本号Tag]&gt;</code> 不指定版本号默认删除最新版本</li>
<li><code>docker rmi [镜像名称image_name]&lt;:[版本号Tag]&gt;</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker image rm centos</span><br><span class="line">Untagged: centos:latest</span><br><span class="line">Untagged: centos@sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177</span><br><span class="line">Deleted: sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6</span><br><span class="line">Deleted: sha256:74ddd0ec08fa43d09f32636ba91a0a3053b02cb4627c35051aff89f853606b59</span><br><span class="line">root@ubuntu-server:~# docker image rm centos:7</span><br><span class="line">Untagged: centos:7</span><br><span class="line">Untagged: centos@sha256:be65f488b7764ad3638f236b7b515b3678369a5124c47b8d32916d6487418ea4</span><br><span class="line">Deleted: sha256:eeb6ee3f44bd0b5103bb561b4c16bcb82328cfe5809ab675bb17ab3a16c517c9</span><br><span class="line">Deleted: sha256:174f5685490326fc0a1c0f5570b8663732189b327007e47ff13d2ca59673db02</span><br><span class="line">root@ubuntu-server:~# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mysql         latest    56b21e040954   5 days ago     632MB</span><br><span class="line">nginx         latest    a8758716bb6a   3 months ago   187MB</span><br><span class="line">hello-world   latest    d2c94e258dcb   8 months ago   13.3kB</span><br><span class="line">nginx         1.24.0    f373f7a623e7   9 months ago   142MB</span><br></pre></td></tr></table></figure>

<h2 id="编写-Dockerfile"><a href="#编写-Dockerfile" class="headerlink" title="编写 Dockerfile"></a>编写 Dockerfile</h2><p>新建一个 Flask 项目并且创建 Dockerfile、app.py、requirements.txt</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu:latest</span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> authors=<span class="string">&quot;zachary&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y python3 python3-pip</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> app.py /opt/app.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> FLASK_APP=/opt/app.py flask run --host=0.0.0.0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():  <span class="comment"># put application&#x27;s code here</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/index&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Index Page!&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>将上述代码打包放到 GitHub：<a target="_blank" rel="noopener" href="https://github.com/BlockZachary/flaskDockerSample">https://github.com/BlockZachary/flaskDockerSample</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706121719838-602b43bd-a754-4190-b607-cb196116331e.png"></p>
<p>然后在服务器主机上面操作，先将代码克隆到主机上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject# git clone https://github.com/BlockZachary/flaskDockerSample.git</span><br><span class="line">19:10:50.593675 git.c:439               trace: built-in: git clone https://github.com/BlockZachary/flaskDockerSample.git</span><br><span class="line">Cloning into &#x27;flaskDockerSample&#x27;...</span><br><span class="line">19:10:50.598505 run-command.c:663       trace: run_command: git-remote-https origin https://github.com/BlockZachary/flaskDockerSample.git</span><br><span class="line">* Couldn&#x27;t find host github.com in the .netrc file; using defaults</span><br><span class="line">*   Trying 140.82.113.4:443...</span><br><span class="line">* TCP_NODELAY set</span><br><span class="line">* Connected to github.com (140.82.113.4) port 443 (#0)</span><br><span class="line">* found 411 certificates in /etc/ssl/certs</span><br><span class="line">* ALPN, offering h2</span><br><span class="line">* ALPN, offering http/1.1</span><br><span class="line">* SSL connection using TLS1.3 / ECDHE_RSA_AES_128_GCM_SHA256</span><br><span class="line">* 	 server certificate verification OK</span><br><span class="line">* 	 server certificate status verification SKIPPED</span><br><span class="line">* 	 common name: github.com (matched)</span><br><span class="line">* 	 server certificate expiration date OK</span><br><span class="line">* 	 server certificate activation date OK</span><br><span class="line">* 	 certificate public key: EC/ECDSA</span><br><span class="line">* 	 certificate version: #3</span><br><span class="line">* 	 subject: C=US,ST=California,L=San Francisco,O=GitHub\, Inc.,CN=github.com</span><br><span class="line">* 	 start date: Tue, 14 Feb 2023 00:00:00 GMT</span><br><span class="line">* 	 expire date: Thu, 14 Mar 2024 23:59:59 GMT</span><br><span class="line">* 	 issuer: C=US,O=DigiCert Inc,CN=DigiCert TLS Hybrid ECC SHA384 2020 CA1</span><br><span class="line">* ALPN, server accepted to use h2</span><br><span class="line">* Using HTTP2, server supports multi-use</span><br><span class="line">* Connection state changed (HTTP/2 confirmed)</span><br><span class="line">* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0</span><br><span class="line">* Using Stream ID: 1 (easy handle 0x55691a2a4f80)</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">GET /BlockZachary/flaskDockerSample.git/info/refs?service=git-upload-pack HTTP/2</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject# ll</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 3 root root 4096 Jan 24 19:10 ./</span><br><span class="line">drwx------ 8 root root 4096 Jan 24 19:04 ../</span><br><span class="line">drwxr-xr-x 3 root root 4096 Jan 24 19:10 flaskDockerSample/</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject# cd flaskDockerSample</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample# ll</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x 3 root root 4096 Jan 24 19:10 ./</span><br><span class="line">drwxr-xr-x 3 root root 4096 Jan 24 19:10 ../</span><br><span class="line">-rw-r--r-- 1 root root  245 Jan 24 19:10 app.py</span><br><span class="line">-rw-r--r-- 1 root root  253 Jan 24 19:10 Dockerfile</span><br><span class="line">drwxr-xr-x 8 root root 4096 Jan 24 19:10 .git/</span><br><span class="line">-rw-r--r-- 1 root root    5 Jan 24 19:10 requirements.txt</span><br></pre></td></tr></table></figure>

<h2 id="构建自己的-Image"><a href="#构建自己的-Image" class="headerlink" title="构建自己的 Image"></a>构建自己的 Image</h2><ul>
<li><code>docker build . -t [镜像名称]&lt;:[版本号]&gt;</code> 不填写版本号默认是一个 latest .指的是当前目录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample# docker build . -t myflasksample</span><br><span class="line">[+] Building 178.7s (11/11) FINISHED                                                                    docker:default</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                              0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 258B                                                                              0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                 0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                   0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/ubuntu:latest                                                 33.7s</span><br><span class="line"> =&gt; CACHED [1/6] FROM docker.io/library/ubuntu@sha256:e6173d4dc55e76b87c4af8db8821b1feae4146dd47341e4d431118c7dd  0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                 0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 63B                                                                                  0.0s</span><br><span class="line"> =&gt; [2/6] RUN apt update                                                                                         10.6s</span><br><span class="line"> =&gt; [3/6] RUN apt-get install -y python3.6 python3-pip                                                           45.0s</span><br><span class="line"> =&gt; [4/6] COPY requirements.txt .                                                                                 0.0s</span><br><span class="line"> =&gt; [5/6] RUN pip3 install -r requirements.txt                                                                   86.7s</span><br><span class="line"> =&gt; [6/6] COPY app.py /opt/app.py                                                                                 0.0s</span><br><span class="line"> =&gt; exporting to image                                                                                            2.4s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                           2.4s</span><br><span class="line"> =&gt; =&gt; writing image sha256:e4e6142e4b4159d2becbc57a7d298796fb7613727dafca902dec9f6f641cb39f                      0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/myflasksample                                                                  0.0s</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample# docker images</span><br><span class="line">REPOSITORY      TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">myflasksample   latest    e4e6142e4b41   About a minute ago   484MB</span><br><span class="line">mysql           latest    56b21e040954   6 days ago           632MB</span><br><span class="line">nginx           latest    a8758716bb6a   3 months ago         187MB</span><br><span class="line">hello-world     latest    d2c94e258dcb   8 months ago         13.3kB</span><br><span class="line">nginx           1.24.0    f373f7a623e7   9 months ago         142MB</span><br><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample#</span><br></pre></td></tr></table></figure>

<h2 id="启用自定义-Image-的容器"><a href="#启用自定义-Image-的容器" class="headerlink" title="启用自定义 Image 的容器"></a>启用自定义 Image 的容器</h2><p>因为这块用的例子是一个 flask 项目，端口号用的默认是 5000</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample# docker run -p 8080:5000 myflasksample</span><br><span class="line"> * Serving Flask app &#x27;/opt/app.py&#x27;</span><br><span class="line"> * Debug mode: off</span><br><span class="line">WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.</span><br><span class="line"> * Running on all addresses (0.0.0.0)</span><br><span class="line"> * Running on http://127.0.0.1:5000</span><br><span class="line"> * Running on http://172.17.0.2:5000</span><br><span class="line">Press CTRL+C to quit</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker ps</span><br><span class="line">CONTAINER ID   IMAGE           COMMAND                  CREATED          STATUS          PORTS                                       NAMES</span><br><span class="line">2f5c78d92ee9   myflasksample   &quot;/bin/sh -c &#x27;FLASK_A…&quot;   43 seconds ago   Up 41 seconds   0.0.0.0:8080-&gt;5000/tcp, :::8080-&gt;5000/tcp   busy_cori</span><br><span class="line">root@ubuntu-server:~# docker inspect 2f5c78d92ee9 | grep &quot;IPAddress&quot;</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# curl http://172.17.0.2:5000</span><br><span class="line">Hello World!root@ubuntcurl http://172.17.0.2:5000/index</span><br><span class="line">Index Page!root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<p>使用浏览器也可以正常访问</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706132499132-065f12de-d2c5-42f5-9aac-be888b35735e.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706132515824-b5465bcb-ba3f-43d7-8d27-a13e0c70d330.png"></p>
<h2 id="创建-docker-官方账号、登录"><a href="#创建-docker-官方账号、登录" class="headerlink" title="创建 docker 官方账号、登录"></a>创建 docker 官方账号、登录</h2><p>首先在<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a>，注册账号</p>
<p>然后可以在主机中使用 <code>docker login</code>、<code>docker logout</code>进行登录、登出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker login</span><br><span class="line">Log in with your Docker ID or email address to push and pull images from Docker Hub. If you don&#x27;t have a Docker ID, head over to https://hub.docker.com/ to create one.</span><br><span class="line">You can log in with your password or a Personal Access Token (PAT). Using a limited-scope PAT grants better security and is required for organizations using SSO. Learn more at https://docs.docker.com/go/access-tokens/</span><br><span class="line"></span><br><span class="line">Username: zacharyblock</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line">root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<p>然后再去官网创建一个仓库</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706133243473-d454141b-fe18-4764-a744-d98e1d9db0b1.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706133357108-7eb5dcf9-14c4-46c3-9552-3b9fc6960399.png"></p>
<p>可以看到右侧有一段这样的命令：<code>docker push zacharyblock/myflasksample:tagname</code>,</p>
<p>为了实现推送的，必须有一个名称为 <code>zacharyblock/myflasksample</code>的镜像，但是前一步操作，我们只构建了一个名称为<code>myflasksample</code>的镜像，因此我们还需要重新构建一次</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706133399584-243e093f-a831-4b30-baab-db58a7dc5d08.png"></p>
<p>使用<code>docker build . -t zacharyblock/myflasksample</code>构建一下 image</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample# docker build . -t zacharyblock/myflasksample</span><br><span class="line">[+] Building 34.8s (12/12) FINISHED                                                                                                docker:default</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                                                         0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 258B                                                                                                         0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                                            0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                              0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/ubuntu:latest                                                                            34.7s</span><br><span class="line"> =&gt; [auth] library/ubuntu:pull token for registry-1.docker.io                                                                                0.0s</span><br><span class="line"> =&gt; [1/6] FROM docker.io/library/ubuntu@sha256:e6173d4dc55e76b87c4af8db8821b1feae4146dd47341e4d431118c7dd060a74                              0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                                            0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 63B                                                                                                             0.0s</span><br><span class="line"> =&gt; CACHED [2/6] RUN apt update                                                                                                              0.0s</span><br><span class="line"> =&gt; CACHED [3/6] RUN apt-get install -y python3.6 python3-pip                                                                                0.0s</span><br><span class="line"> =&gt; CACHED [4/6] COPY requirements.txt .                                                                                                     0.0s</span><br><span class="line"> =&gt; CACHED [5/6] RUN pip3 install -r requirements.txt                                                                                        0.0s</span><br><span class="line"> =&gt; CACHED [6/6] COPY app.py /opt/app.py                                                                                                     0.0s</span><br><span class="line"> =&gt; exporting to image                                                                                                                       0.0s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; writing image sha256:e4e6142e4b4159d2becbc57a7d298796fb7613727dafca902dec9f6f641cb39f                                                 0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/zacharyblock/myflasksample                                                                                        0.0s</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample# docker images</span><br><span class="line">REPOSITORY                   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">myflasksample                latest    e4e6142e4b41   30 minutes ago   484MB</span><br><span class="line">zacharyblock/myflasksample   latest    e4e6142e4b41   30 minutes ago   484MB</span><br><span class="line">mysql                        latest    56b21e040954   6 days ago       632MB</span><br><span class="line">nginx                        latest    a8758716bb6a   3 months ago     187MB</span><br><span class="line">hello-world                  latest    d2c94e258dcb   8 months ago     13.3kB</span><br><span class="line">nginx                        1.24.0    f373f7a623e7   9 months ago     142MB</span><br><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample#</span><br></pre></td></tr></table></figure>

<h2 id="推送镜像到远程仓库"><a href="#推送镜像到远程仓库" class="headerlink" title="推送镜像到远程仓库"></a>推送镜像到远程仓库</h2><ul>
<li><code>docker push [镜像名称]&lt;:[版本号]&gt;</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject/flaskDockerSample# docker push zacharyblock/myflasksample</span><br><span class="line">Using default tag: latest</span><br><span class="line">The push refers to repository [docker.io/zacharyblock/myflasksample]</span><br><span class="line">fe70b6de3f96: Pushing [==================================================&gt;]   2.56kB</span><br><span class="line">e30e40d2f01d: Pushing [==================================================&gt;]  4.893MB</span><br><span class="line">79c28b0cc016: Pushed</span><br><span class="line">f9d63cb94619: Pushing [========&gt;                                          ]  61.53MB/354.7MB</span><br><span class="line">f0fad7c9b1fd: Pushing [====================&gt;                              ]  19.65MB/47.07MB</span><br><span class="line">8e87ff28f1b5: Waiting</span><br></pre></td></tr></table></figure>

<p>推送好了之后，官网可以看到</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706134242798-626c6197-b1b8-43a0-b678-af559ec2a208.png"></p>
<p>尝试一下拉取，先删除掉已经有的这个 image，然后再拉取</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker images</span><br><span class="line">REPOSITORY                   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">myflasksample                latest    e4e6142e4b41   39 minutes ago   484MB</span><br><span class="line">zacharyblock/myflasksample   latest    e4e6142e4b41   39 minutes ago   484MB</span><br><span class="line">mysql                        latest    56b21e040954   6 days ago       632MB</span><br><span class="line">nginx                        latest    a8758716bb6a   3 months ago     187MB</span><br><span class="line">hello-world                  latest    d2c94e258dcb   8 months ago     13.3kB</span><br><span class="line">nginx                        1.24.0    f373f7a623e7   9 months ago     142MB</span><br><span class="line">root@ubuntu-server:~# docker rmi zacharyblock/myflasksample</span><br><span class="line">Untagged: zacharyblock/myflasksample:latest</span><br><span class="line">Untagged: zacharyblock/myflasksample@sha256:ea37221e82fe285cd50ff202ae9c08d445a779e40cc3a9f8fbe897144ca2d304</span><br><span class="line">root@ubuntu-server:~# docker images</span><br><span class="line">REPOSITORY      TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">myflasksample   latest    e4e6142e4b41   39 minutes ago   484MB</span><br><span class="line">mysql           latest    56b21e040954   6 days ago       632MB</span><br><span class="line">nginx           latest    a8758716bb6a   3 months ago     187MB</span><br><span class="line">hello-world     latest    d2c94e258dcb   8 months ago     13.3kB</span><br><span class="line">nginx           1.24.0    f373f7a623e7   9 months ago     142MB</span><br><span class="line">root@ubuntu-server:~# docker pull zacharyblock/myflasksample</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from zacharyblock/myflasksample</span><br><span class="line">Digest: sha256:ea37221e82fe285cd50ff202ae9c08d445a779e40cc3a9f8fbe897144ca2d304</span><br><span class="line">Status: Downloaded newer image for zacharyblock/myflasksample:latest</span><br><span class="line">docker.io/zacharyblock/myflasksample:latest</span><br><span class="line">root@ubuntu-server:~# docker images</span><br><span class="line">REPOSITORY                   TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">myflasksample                latest    e4e6142e4b41   41 minutes ago   484MB</span><br><span class="line">zacharyblock/myflasksample   latest    e4e6142e4b41   41 minutes ago   484MB</span><br><span class="line">mysql                        latest    56b21e040954   6 days ago       632MB</span><br><span class="line">nginx                        latest    a8758716bb6a   3 months ago     187MB</span><br><span class="line">hello-world                  latest    d2c94e258dcb   8 months ago     13.3kB</span><br><span class="line">nginx                        1.24.0    f373f7a623e7   9 months ago     142MB</span><br></pre></td></tr></table></figure>

<h1 id="Dockerfile-的-CMD-与-ENTRYPOINT"><a href="#Dockerfile-的-CMD-与-ENTRYPOINT" class="headerlink" title="Dockerfile 的 CMD 与 ENTRYPOINT"></a>Dockerfile 的 CMD 与 ENTRYPOINT</h1><h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>为了可以使用命令或者参数在启动容器的时候启动一些我们需要的默认程序，可以使用 CMD</p>
<ul>
<li>Dockerfile 中的 CMD 指令格式<ul>
<li><code>CMD [shell命令]</code> 通过 sh 的形式</li>
<li><code>CMD [&quot;命令&quot;,&quot;参数1&quot;,&quot;参数2&quot;,...]</code></li>
</ul>
</li>
<li>如果 Dockerfile 中存在多条 CMD 最后一条生效</li>
<li>可以通过在启动容器时，添加参数对 CMD 命令进行替换<ul>
<li><code>docker run -it [镜像] [命令] [参数1] [参数2]</code></li>
</ul>
</li>
</ul>
<p>这块来一个例子</p>
<p>仍旧是在 ubuntu 主机上面先创建一个项目目录，然后准备 Dockerfile 和 app.py</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject# mkdir cmdDockerSample</span><br><span class="line">root@ubuntu-server:~/pythonProject# cd cmdDockerSample/</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample# pwd</span><br><span class="line">/root/pythonProject/cmdDockerSample</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample# nano Dockerfile</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample# cat Dockerfile</span><br><span class="line">FROM ubuntu</span><br><span class="line"></span><br><span class="line">RUN apt update</span><br><span class="line">RUN apt-get install -y python3</span><br><span class="line"></span><br><span class="line">COPY app.py /opt/app.py</span><br><span class="line"></span><br><span class="line">WORKDIR /opt/</span><br><span class="line"></span><br><span class="line">CMD [&quot;python3&quot;, &quot;app.py&quot;, &quot;para1&quot;, &quot;para2&quot;]</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample# nano app.py</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample# cat app.py</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">print(sys.argv)</span><br></pre></td></tr></table></figure>

<p>然后对该项目进行镜像构建，构建一个容器后会打印出参数，也可以通过命令参数进行 CMD 替换</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample# docker build . -t cmddockersample</span><br><span class="line">[+] Building 209.6s (10/10) FINISHED                                                                                                                         docker:default</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                                                        0.0s</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                                                                                   0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 183B                                                                                                                                   0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/ubuntu:latest                                                                                                       0.0s</span><br><span class="line"> =&gt; CACHED [1/5] FROM docker.io/library/ubuntu                                                                                                                         0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 27B                                                                                                                                       0.0s</span><br><span class="line"> =&gt; [2/5] RUN apt update                                                                                                                                             198.6s</span><br><span class="line"> =&gt; [3/5] RUN apt-get install -y python3                                                                                                                              10.6s</span><br><span class="line"> =&gt; [4/5] COPY app.py /opt/app.py                                                                                                                                      0.1s</span><br><span class="line"> =&gt; [5/5] WORKDIR /opt/                                                                                                                                                0.0s</span><br><span class="line"> =&gt; exporting to image                                                                                                                                                 0.3s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                                                                0.3s</span><br><span class="line"> =&gt; =&gt; writing image sha256:153eeb8273c48d59c08f467e270a5f7518e02135fa32a758439409e0055b4f52                                                                           0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/cmddockersample                                                                                                                     0.0s</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample# docker run -it cmddockersample</span><br><span class="line">[&#x27;app.py&#x27;, &#x27;para1&#x27;, &#x27;para2&#x27;]</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample# docker run -it cmddockersample sleep 5</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdDockerSample#</span><br></pre></td></tr></table></figure>

<h2 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h2><p>用于指定启动容器时候默认运行的程序</p>
<ul>
<li>Dockerfile 中的 ENTRYPOINT 指令格式<ul>
<li><code>ENTRYPOINT [shell命令]</code> 通过 sh 的形式</li>
<li><code>ENTRYPOINT [&quot;命令&quot;,&quot;参数1&quot;,&quot;参数2&quot;,...]</code></li>
</ul>
</li>
<li>如果 Dockerfile 中只能定义一个 ENTRYPOINT</li>
<li>在启动容器时，不可以对 ENTRYPOINT 命令进行替换</li>
<li>可以用 CMD 给 ENTRYPOINT 指定参数</li>
</ul>
<p>来一个实例看看</p>
<p>先创建一个 entrypointDockerSample 目录，然后还是创建 Dockerfile 和 app.py</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject# mkdir entrypointDockerSample</span><br><span class="line">root@ubuntu-server:~/pythonProject# cd entrypointDockerSample/</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject/entrypointDockerSample# nano Dockerfile</span><br><span class="line">root@ubuntu-server:~/pythonProject/entrypointDockerSample# cat Dockerfile</span><br><span class="line">FROM ubuntu</span><br><span class="line"></span><br><span class="line">RUN apt update</span><br><span class="line">RUN apt-get install -y python3</span><br><span class="line"></span><br><span class="line">COPY app.py /opt/app.py</span><br><span class="line"></span><br><span class="line">WORKDIR /opt/</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;python3&quot;, &quot;app.py&quot;, &quot;para1&quot;, &quot;para2&quot;]</span><br><span class="line">root@ubuntu-server:~/pythonProject/entrypointDockerSample# nano app.py</span><br><span class="line">root@ubuntu-server:~/pythonProject/entrypointDockerSample# cat app.py</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">print(sys.argv)</span><br><span class="line">root@ubuntu-server:~/pythonProject/entrypointDockerSample# docker build . -t entrypointdockersample</span><br><span class="line">[+] Building 0.1s (10/10) FINISHED                                                                                                                           docker:default</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                                                                                   0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 190B                                                                                                                                   0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                                                        0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/ubuntu:latest                                                                                                       0.0s</span><br><span class="line"> =&gt; [1/5] FROM docker.io/library/ubuntu                                                                                                                                0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 61B                                                                                                                                       0.0s</span><br><span class="line"> =&gt; CACHED [2/5] RUN apt update                                                                                                                                        0.0s</span><br><span class="line"> =&gt; CACHED [3/5] RUN apt-get install -y python3                                                                                                                        0.0s</span><br><span class="line"> =&gt; CACHED [4/5] COPY app.py /opt/app.py                                                                                                                               0.0s</span><br><span class="line"> =&gt; CACHED [5/5] WORKDIR /opt/                                                                                                                                         0.0s</span><br><span class="line"> =&gt; exporting to image                                                                                                                                                 0.0s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                                                                0.0s</span><br><span class="line"> =&gt; =&gt; writing image sha256:d3e54cbe8477ec5f625fb675a14e5aa2ea3dc9b8be3b2b5efbd3d2a344c5be64                                                                           0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/entrypointdockersample                                                                                                              0.0s</span><br><span class="line">root@ubuntu-server:~/pythonProject/entrypointDockerSample# docker run -it entrypointdockersample</span><br><span class="line">[&#x27;app.py&#x27;, &#x27;para1&#x27;, &#x27;para2&#x27;]</span><br><span class="line">root@ubuntu-server:~/pythonProject/entrypointDockerSample# docker run -it entrypointdockersample sleep 5</span><br><span class="line">[&#x27;app.py&#x27;, &#x27;para1&#x27;, &#x27;para2&#x27;, &#x27;sleep&#x27;, &#x27;5&#x27;]</span><br><span class="line">root@ubuntu-server:~/pythonProject/entrypointDockerSample#</span><br></pre></td></tr></table></figure>

<p>通过上面的例子可以看出来，当使用了 entrypoint 的时候 在创建容器的时候命令行增加的参数并没有替换掉原先的参数 而是给原先的参数增加上了</p>
<h2 id="CMD-结合-ENTRYPOINT"><a href="#CMD-结合-ENTRYPOINT" class="headerlink" title="CMD 结合 ENTRYPOINT"></a>CMD 结合 ENTRYPOINT</h2><p>通过上面两个例子，如果将 CMD 和 ENTRYPOINT 结合起来使用 可以实现对既定的命令保持不变 对某些参数进行替换的操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/pythonProject# mkdir cmdEntrypointDockerSample</span><br><span class="line">root@ubuntu-server:~/pythonProject# cd cmdEntrypointDockerSample/</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample# nano Dockerfile</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample# cat Dockerfile</span><br><span class="line">FROM ubuntu</span><br><span class="line"></span><br><span class="line">RUN apt update</span><br><span class="line">RUN apt-get install -y python3</span><br><span class="line"></span><br><span class="line">COPY app.py /opt/app.py</span><br><span class="line"></span><br><span class="line">WORKDIR /opt/</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;python3&quot;, &quot;app.py&quot;]</span><br><span class="line">CMD [&quot;para1&quot;,&quot;para2&quot;]</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample# nano app.py</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample# cat app.py</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">print(sys.argv)</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample# docker build . -t cmdEntrypointDockerSample</span><br><span class="line">[+] Building 0.0s (0/0)                                                                                                                                      docker:default</span><br><span class="line">ERROR: invalid tag &quot;cmdEntrypointDockerSample&quot;: repository name must be lowercase</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample#</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample# docker build . -t cmdentrypointdockersample</span><br><span class="line">[+] Building 0.1s (10/10) FINISHED                                                                                                                           docker:default</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                                                                                   0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 195B                                                                                                                                   0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                                                        0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/ubuntu:latest                                                                                                       0.0s</span><br><span class="line"> =&gt; [1/5] FROM docker.io/library/ubuntu                                                                                                                                0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 61B                                                                                                                                       0.0s</span><br><span class="line"> =&gt; CACHED [2/5] RUN apt update                                                                                                                                        0.0s</span><br><span class="line"> =&gt; CACHED [3/5] RUN apt-get install -y python3                                                                                                                        0.0s</span><br><span class="line"> =&gt; CACHED [4/5] COPY app.py /opt/app.py                                                                                                                               0.0s</span><br><span class="line"> =&gt; CACHED [5/5] WORKDIR /opt/                                                                                                                                         0.0s</span><br><span class="line"> =&gt; exporting to image                                                                                                                                                 0.0s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                                                                0.0s</span><br><span class="line"> =&gt; =&gt; writing image sha256:01ab92cd6837ea8381cf83e66a2214eb9de94a133b460584fe9a5bf4dc03433e                                                                           0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/cmdentrypointdockersample                                                                                                           0.0s</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample# docker run -it cmdentrypointdockersample</span><br><span class="line">[&#x27;app.py&#x27;, &#x27;para1&#x27;, &#x27;para2&#x27;]</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample# docker run -it cmdentrypointdockersample hello para3</span><br><span class="line">[&#x27;app.py&#x27;, &#x27;hello&#x27;, &#x27;para3&#x27;]</span><br><span class="line">root@ubuntu-server:~/pythonProject/cmdEntrypointDockerSample#</span><br></pre></td></tr></table></figure>

<h1 id="多容器互联"><a href="#多容器互联" class="headerlink" title="多容器互联"></a>多容器互联</h1><h2 id="建立多容器互联网络"><a href="#建立多容器互联网络" class="headerlink" title="建立多容器互联网络"></a>建立多容器互联网络</h2><ul>
<li><code>docker network ls</code>查看当前所有网络</li>
<li><code>docker network create [网络名称]</code> 创建一个新的网络</li>
<li><code>docker network rm [网络名称]</code> 移除一个网络</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">0b6264c729e5   bridge    bridge    local</span><br><span class="line">3bef0fd15183   host      host      local</span><br><span class="line">270d5cbcbd9e   none      null      local</span><br><span class="line">root@ubuntu-server:~# docker network create nw_test</span><br><span class="line">0a683526a3b9476ccba81290f2efd32f12bd04514c428ae6f838482533d663a5</span><br><span class="line">root@ubuntu-server:~# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">0b6264c729e5   bridge    bridge    local</span><br><span class="line">3bef0fd15183   host      host      local</span><br><span class="line">270d5cbcbd9e   none      null      local</span><br><span class="line">0a683526a3b9   nw_test   bridge    local</span><br></pre></td></tr></table></figure>

<h2 id="启动容器并加入互联网络"><a href="#启动容器并加入互联网络" class="headerlink" title="启动容器并加入互联网络"></a>启动容器并加入互联网络</h2><ul>
<li><code>docker run --network [要加入的网络名称] --network-alias [容器在网络中的别名] [镜像名称]</code></li>
</ul>
<p>自己制作一个镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y iputils-ping</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> bash</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/dockerDIYImage/ubuntu_Ping# nano Dockerfile</span><br><span class="line">root@ubuntu-server:~/dockerDIYImage/ubuntu_Ping# docker build . -t myos</span><br><span class="line">[+] Building 6.2s (7/7) FINISHED                                                                       docker:default</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                  0.0s</span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                             0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 112B                                                                             0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/ubuntu:latest                                                 0.0s</span><br><span class="line"> =&gt; [1/3] FROM docker.io/library/ubuntu                                                                          0.0s</span><br><span class="line"> =&gt; CACHED [2/3] RUN apt update                                                                                  0.0s</span><br><span class="line"> =&gt; [3/3] RUN apt-get install -y iputils-ping                                                                    6.1s</span><br><span class="line"> =&gt; exporting to image                                                                                           0.1s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                          0.1s</span><br><span class="line"> =&gt; =&gt; writing image sha256:eb06c6d74ffa1b4e55d02fd29677d262a031fb92985bc38a0e1eba69e784cb61                     0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/myos                                                                          0.0s</span><br><span class="line">root@ubuntu-server:~/dockerDIYImage/ubuntu_Ping#</span><br></pre></td></tr></table></figure>

<p>首先在一个控制台创建一个容器并起别名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -it --rm --network nw_test --network-alias c1 myos</span><br><span class="line">root@e1c90c8fc513:/#</span><br></pre></td></tr></table></figure>

<p>然后在另一个控制台创建另一个容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -it --rm --network nw_test --network-alias c2 myos</span><br><span class="line">root@68be5a3af8a3:/#</span><br></pre></td></tr></table></figure>

<p>然后分别在两个控制台中 ping 对方容器的别名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -it --rm --network nw_test --network-alias c1 myos</span><br><span class="line">root@e1c90c8fc513:/# ping c2</span><br><span class="line">PING c2 (172.18.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from c2.nw_test (172.18.0.3): icmp_seq=1 ttl=64 time=0.301 ms</span><br><span class="line">64 bytes from c2.nw_test (172.18.0.3): icmp_seq=2 ttl=64 time=0.101 ms</span><br><span class="line">64 bytes from c2.nw_test (172.18.0.3): icmp_seq=3 ttl=64 time=0.078 ms</span><br><span class="line">64 bytes from c2.nw_test (172.18.0.3): icmp_seq=4 ttl=64 time=0.098 ms</span><br><span class="line">64 bytes from c2.nw_test (172.18.0.3): icmp_seq=5 ttl=64 time=0.104 ms</span><br><span class="line">^C</span><br><span class="line">--- c2 ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 4007ms</span><br><span class="line">rtt min/avg/max/mdev = 0.078/0.136/0.301/0.082 ms</span><br><span class="line">root@e1c90c8fc513:/#</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -it --rm --network nw_test --network-alias c2 myos</span><br><span class="line">root@68be5a3af8a3:/# ping c1</span><br><span class="line">PING c1 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from c1.nw_test (172.18.0.2): icmp_seq=1 ttl=64 time=0.120 ms</span><br><span class="line">64 bytes from c1.nw_test (172.18.0.2): icmp_seq=2 ttl=64 time=0.102 ms</span><br><span class="line">64 bytes from c1.nw_test (172.18.0.2): icmp_seq=3 ttl=64 time=0.101 ms</span><br><span class="line">64 bytes from c1.nw_test (172.18.0.2): icmp_seq=4 ttl=64 time=0.101 ms</span><br><span class="line">64 bytes from c1.nw_test (172.18.0.2): icmp_seq=5 ttl=64 time=0.100 ms</span><br><span class="line">^C</span><br><span class="line">--- c1 ping statistics ---</span><br><span class="line">5 packets transmitted, 5 received, 0% packet loss, time 4070ms</span><br><span class="line">rtt min/avg/max/mdev = 0.100/0.104/0.120/0.007 ms</span><br><span class="line">root@68be5a3af8a3:/#</span><br></pre></td></tr></table></figure>

<h3 id="创建一个-MySQL-容器并加入互联网络"><a href="#创建一个-MySQL-容器并加入互联网络" class="headerlink" title="创建一个 MySQL 容器并加入互联网络"></a>创建一个 MySQL 容器并加入互联网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -d --rm --network nw_test --network-alias mysql_server -v /opt/mysql:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=wordpressdb mysql</span><br><span class="line">e86fbcde931a1f8bf559980e6c015ff966426d185aeaab29e9b080042ed3ed5f</span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED        STATUS        PORTS                 NAMES</span><br><span class="line">e86fbcde931a   mysql     &quot;docker-entrypoint.s…&quot;   1 second ago   Up 1 second   3306/tcp, 33060/tcp   inspiring_roentgen</span><br><span class="line">root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<h3 id="创建一个-Wordpress-容器并加入互联网络"><a href="#创建一个-Wordpress-容器并加入互联网络" class="headerlink" title="创建一个 Wordpress 容器并加入互联网络"></a>创建一个 Wordpress 容器并加入互联网络</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker run -d --rm -p 82:80 --network nw_test --network-alias wordpress_server -e WORDPRESS_DB_HOST=mysql_server -e WORDPRESS_DB_NAME=wordpressdb -e WORDPRESS_DB_USER=root -e WORDPRESS_DB_PASSWORD=123456 wordpress</span><br><span class="line">e742952bbaa9b3862850eb1afd97e0d4e5700c433025e5034f0ca466581011f2</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED              STATUS              PORTS                               NAMES</span><br><span class="line">e742952bbaa9   wordpress   &quot;docker-entrypoint.s…&quot;   About a minute ago   Up About a minute   0.0.0.0:82-&gt;80/tcp, :::82-&gt;80/tcp   kind_neumann</span><br><span class="line">e86fbcde931a   mysql       &quot;docker-entrypoint.s…&quot;   43 minutes ago       Up 43 minutes       3306/tcp, 33060/tcp                 inspiring_roentgen</span><br><span class="line">root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<p>在浏览器输入主机 ip:82，可以进入 wordpress 页面</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706294843550-3883a64b-15a1-4b60-bafe-5267a559d62b.png"></p>
<p>有这个问题 去解决一下，需要连接一下对应的 mysql 数据库创建一下这个库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker inspect 6b07fc530884 | grep &quot;IPAddress&quot;</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.18.0.2&quot;,</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~# mysql -h 172.18.0.2 -u root -p 123456</span><br><span class="line">Enter password:</span><br><span class="line">ERROR 1049 (42000): Unknown database &#x27;123456&#x27;</span><br><span class="line">root@ubuntu-server:~# mysql -h 172.18.0.2 -u root -p123456</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 81</span><br><span class="line">Server version: 8.3.0 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2023, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| db_in_opt          |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.03 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create database wordpressdb;</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span>;</span></span><br><span class="line">Bye</span><br><span class="line">root@ubuntu-server:~#</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706296763173-f9b11149-45c7-4eea-882b-db8d79429261.png"></p>
<p>现在就可以啦，初步配置一下</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706296802789-27c558e7-aa3b-4295-8574-a6abca230fe8.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706296881539-64e2a848-dc59-4e7b-b609-a25956e25eeb.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706296912157-cb46da7d-583d-456d-a0fb-cc5b910b2cbe.png"></p>
<p>用刚才的用户名和密码进行登录，就进入到后台</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706296946576-569ff0c2-4aa2-40e4-854b-124fb961fa76.png"></p>
<p>比如我们修改一下外观</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706297072686-c126aeba-0467-4c4a-9738-117c49dd5c5c.png"></p>
<p>这个时候用自己的服务器主机的 ip+82，可以访问到主页</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706297130840-3427c5bf-57fa-4a24-b823-e31ac9ab2052.png"></p>
<p>可以对文章进行编辑</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706297227729-d97720ab-8084-4eb4-83d8-8c6ac590c742.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706297283369-47518c84-9ec4-45b9-a574-691e0286d759.png"></p>
<p>然后可以查看到效果</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706297351367-01477c9e-918e-41aa-bdd1-2a8d2a959545.png"></p>
<h1 id="Compose"><a href="#Compose" class="headerlink" title="Compose"></a>Compose</h1><p>用于定义和运行多容器的工具，简化上一节中讲到的多容器互联复杂的命令输入环节</p>
<ul>
<li>通过 YAML 文件的格式定义多容器关系</li>
</ul>
<h2 id="安装-docker-compose"><a href="#安装-docker-compose" class="headerlink" title="安装 docker compose"></a>安装 docker compose</h2><ul>
<li>Mac 和 Windows 下的 docker 默认已经安装了 docker compose</li>
<li>Linux 下的 ubuntu 安装 docker compose<ul>
<li><code>apt-get install docker-compose</code></li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706352965049-66541969-972c-404d-8b14-e1c39d196365.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# docker-compose --version</span><br><span class="line">docker-compose version 1.25.0, build unknown</span><br></pre></td></tr></table></figure>

<h2 id="定义-Docker-Compose-多容器"><a href="#定义-Docker-Compose-多容器" class="headerlink" title="定义 Docker Compose 多容器"></a>定义 Docker Compose 多容器</h2><p>创建一个 docker-compose.yaml 文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">wordpress_server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">wordpress</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;82:80&quot;</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql_server</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_HOST:</span> <span class="string">mysql_server</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_NAME:</span> <span class="string">wordpressdb</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_USER:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">WORDPRESS_DB_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql_server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">wordpressdb</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~# ls</span><br><span class="line">docker.cnf  dockerDIYImage  pythonProject  snap</span><br><span class="line">root@ubuntu-server:~# mkdir dockerProject</span><br><span class="line">root@ubuntu-server:~# cd dockerProject/</span><br><span class="line">root@ubuntu-server:~/dockerProject# mkdir myWebSite</span><br><span class="line">root@ubuntu-server:~/dockerProject# cd myWebSite/</span><br><span class="line"></span><br><span class="line">root@ubuntu-server:~/dockerProject/myWebSite# nano docker-compose.yaml</span><br><span class="line">root@ubuntu-server:~/dockerProject/myWebSite# cat docker-compose.yaml</span><br><span class="line">version: &#x27;3.8&#x27;</span><br><span class="line">services:</span><br><span class="line">  wordpress_server:</span><br><span class="line">    image: wordpress</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;82:80&quot;</span><br><span class="line">    links:</span><br><span class="line">      - mysql_server</span><br><span class="line">    environment:</span><br><span class="line">      WORDPRESS_DB_HOST: mysql_server</span><br><span class="line">      WORDPRESS_DB_NAME: wordpressdb</span><br><span class="line">      WORDPRESS_DB_USER: root</span><br><span class="line">      WORDPRESS_DB_PASSWORD: 123456</span><br><span class="line"></span><br><span class="line">  mysql_server:</span><br><span class="line">    image: mysql</span><br><span class="line">    volumes:</span><br><span class="line">      - /opt/mysql:/var/lib/mysql</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: 123456</span><br><span class="line">      MYSQL_DATABASE: wordpressdb</span><br></pre></td></tr></table></figure>

<h2 id="启动与停止-Docker-Compose"><a href="#启动与停止-Docker-Compose" class="headerlink" title="启动与停止 Docker Compose"></a>启动与停止 Docker Compose</h2><ul>
<li><code>docker compose up</code> 启动</li>
<li><code>docker compose down</code> 停止</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/dockerProject/myWebSite# docker compose up</span><br><span class="line">[+] Running 2/0</span><br><span class="line"> ✔ Container mywebsite-mysql_server-1      Created                                                                              0.0s</span><br><span class="line"> ✔ Container mywebsite-wordpress_server-1  Created                                                                              0.0s</span><br><span class="line">Attaching to mywebsite-mysql_server-1, mywebsite-wordpress_server-1</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27 13:00:05+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27 13:00:05+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27 13:00:05+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">mywebsite-wordpress_server-1  | WordPress not found in /var/www/html - copying now...</span><br><span class="line">mywebsite-mysql_server-1      | &#x27;/var/lib/mysql/mysql.sock&#x27; -&gt; &#x27;/var/run/mysqld/mysqld.sock&#x27;</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:06.091635Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:06.480419Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.3.0) starting as process 1</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:06.491181Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:07.542230Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:08.337107Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:08.338334Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:08.342758Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location &#x27;/var/run/mysqld&#x27; in the path is accessible to all OS users. Consider choosing a different directory.</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:08.455139Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /var/run/mysqld/mysqlx.sock</span><br><span class="line">mywebsite-mysql_server-1      | 2024-01-27T13:00:08.457193Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: &#x27;8.3.0&#x27;  socket: &#x27;/var/run/mysqld/mysqld.sock&#x27;  port: 3306  MySQL Community Server - GPL.</span><br><span class="line">mywebsite-wordpress_server-1  | Complete! WordPress has been successfully copied to /var/www/html</span><br><span class="line">mywebsite-wordpress_server-1  | No &#x27;wp-config.php&#x27; found in /var/www/html, but &#x27;WORDPRESS_...&#x27; variables supplied; copying &#x27;wp-config-docker.php&#x27; (WORDPRESS_DB_HOST WORDPRESS_DB_NAME WORDPRESS_DB_PASSWORD WORDPRESS_DB_USER)</span><br><span class="line">mywebsite-wordpress_server-1  | AH00558: apache2: Could not reliably determine the server&#x27;s fully qualified domain name, using 172.19.0.3. Set the &#x27;ServerName&#x27; directive globally to suppress this message</span><br><span class="line">mywebsite-wordpress_server-1  | AH00558: apache2: Could not reliably determine the server&#x27;s fully qualified domain name, using 172.19.0.3. Set the &#x27;ServerName&#x27; directive globally to suppress this message</span><br><span class="line">mywebsite-wordpress_server-1  | [Sat Jan 27 13:00:10.346157 2024] [mpm_prefork:notice] [pid 1] AH00163: Apache/2.4.57 (Debian) PHP/8.2.15 configured -- resuming normal operations</span><br><span class="line">mywebsite-wordpress_server-1  | [Sat Jan 27 13:00:10.347867 2024] [core:notice] [pid 1] AH00094: Command line: &#x27;apache2 -D FOREGROUND&#x27;</span><br></pre></td></tr></table></figure>

<p>启动之后可以直接使用浏览器访问服务器 ip+82，可以直接访问到上一节的服务，因为之前是映射了 mysql 数据到了服务器主机上面的，所以这次只要还是映射了，数据依然存在，当然如果删除掉了数据，就会重新创建</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706360564211-ea36369c-d206-4ae3-9583-ac20a5c872ca.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/dockerProject/myWebSite# docker compose down</span><br><span class="line">[+] Running 3/3</span><br><span class="line"> ✔ Container mywebsite-wordpress_server-1  Removed                                                                              1.3s</span><br><span class="line"> ✔ Container mywebsite-mysql_server-1      Removed                                                                              1.6s</span><br><span class="line"> ✔ Network mywebsite_default               Removed                                                                              0.1s</span><br><span class="line">root@ubuntu-server:~/dockerProject/myWebSite#</span><br></pre></td></tr></table></figure>

<h2 id="构建自己的镜像启动多容器"><a href="#构建自己的镜像启动多容器" class="headerlink" title="构建自己的镜像启动多容器"></a>构建自己的镜像启动多容器</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y python3 python3-pip</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y pkg-config</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y default-libmysqlclient-dev</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> requirements.txt .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install -r requirements.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> app.py /opt/app.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /opt/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;python3&quot;</span>,<span class="string">&quot;app.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlalchemy</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">DB_HOST = os.getenv(<span class="string">&quot;DB_HOST&quot;</span>)</span><br><span class="line">DB_USER = os.getenv(<span class="string">&quot;DB_USER&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">DB_PASSWORD = os.getenv(<span class="string">&quot;DB_PASSWORD&quot;</span>)</span><br><span class="line">DB_PORT = os.getenv(<span class="string">&quot;DB_PORT&quot;</span>,<span class="string">&quot;3306&quot;</span>)</span><br><span class="line">DB_DATABASE = os.getenv(<span class="string">&quot;DB_DATABASE&quot;</span>,<span class="string">&quot;mydb&quot;</span>)</span><br><span class="line"></span><br><span class="line">engine = sqlalchemy.create_engine(<span class="string">f&quot;mysql://<span class="subst">&#123;DB_USER&#125;</span>:<span class="subst">&#123;DB_PASSWORD&#125;</span>@<span class="subst">&#123;DB_HOST&#125;</span>/<span class="subst">&#123;DB_DATABASE&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> engine.connect() <span class="keyword">as</span> conn:</span><br><span class="line">	query = sqlalchemy.text(<span class="string">&quot;SELECT @@version&quot;</span>)</span><br><span class="line">	result_set = conn.execute(query)</span><br><span class="line"></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;MySQL version:&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> row <span class="keyword">in</span> result_set:</span><br><span class="line">		<span class="built_in">print</span>(row)</span><br><span class="line"></span><br><span class="line">engine.dispose()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">dbmanager_server:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">dbmanager</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">dbmanager_server</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql_server</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">DB_HOST:</span> <span class="string">mysql_server</span></span><br><span class="line">      <span class="attr">DB_NAME:</span> <span class="string">mydb</span></span><br><span class="line">      <span class="attr">DB_USER:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">DB_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="attr">mysql_server:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">service_healthy</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mysql_server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mysql_server</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/opt/mysql:/var/lib/mysql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">mydb</span></span><br><span class="line">    <span class="attr">healthcheck:</span></span><br><span class="line">      <span class="attr">test:</span> [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;mysqladmin&quot;</span>, <span class="string">&quot;ping&quot;</span>, <span class="string">&quot;-h&quot;</span>, <span class="string">&quot;localhost&quot;</span>]</span><br><span class="line">      <span class="attr">timeout:</span> <span class="string">20s</span></span><br><span class="line">      <span class="attr">retries:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqlclient==2.1.1</span><br><span class="line">SQLAlchemy==2.0.25</span><br></pre></td></tr></table></figure>

<p>由于网络太慢了 修改一下 Dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> ubuntu</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y python3 python3-pip</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y pkg-config</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apt-get install -y default-libmysqlclient-dev</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com mysqlclient==2.1.1</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip3 install -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com SQLAlchemy==2.0.25</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> app.py /opt/app.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /opt/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;python3&quot;</span>,<span class="string">&quot;app.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>但是这时候还是出了问题，定位到最后是因为没有初始化 mydb 这个数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/dockerProject/docker_dbmanager# docker compose up --build</span><br><span class="line">[+] Building 18.5s (14/14) FINISHED                                                                                   docker:default</span><br><span class="line"> =&gt; [dbmanager_server internal] load build definition from Dockerfile                                                           0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 492B                                                                                            0.0s</span><br><span class="line"> =&gt; [dbmanager_server internal] load metadata for docker.io/library/ubuntu:latest                                               0.0s</span><br><span class="line"> =&gt; [dbmanager_server internal] load .dockerignore                                                                              0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                 0.0s</span><br><span class="line"> =&gt; [dbmanager_server 1/9] FROM docker.io/library/ubuntu:latest                                                                 0.0s</span><br><span class="line"> =&gt; [dbmanager_server internal] load build context                                                                              0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 28B                                                                                                0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 2/9] RUN apt update                                                                                0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 3/9] RUN apt-get install -y python3 python3-pip                                                    0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 4/9] RUN apt-get install -y pkg-config                                                             0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 5/9] RUN apt-get install -y default-libmysqlclient-dev                                             0.0s</span><br><span class="line"> =&gt; [dbmanager_server 6/9] RUN pip3 install -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com mysqlc  4.7s</span><br><span class="line"> =&gt; [dbmanager_server 7/9] RUN pip3 install -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com SQLAlc  7.0s</span><br><span class="line"> =&gt; [dbmanager_server 8/9] COPY app.py /opt/app.py                                                                              0.1s</span><br><span class="line"> =&gt; [dbmanager_server 9/9] WORKDIR /opt/                                                                                        0.0s</span><br><span class="line"> =&gt; [dbmanager_server] exporting to image                                                                                       6.6s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                         6.6s</span><br><span class="line"> =&gt; =&gt; writing image sha256:8cea6473ccddbca8135c6c55eab4151d8414a019820618b97c02d468d2487062                                    0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/dbmanager                                                                                    0.0s</span><br><span class="line">[+] Running 3/3</span><br><span class="line"> ✔ Network docker_dbmanager_default  Created                                                                                    0.1s</span><br><span class="line"> ✔ Container mysql_server            Created                                                                                    0.1s</span><br><span class="line"> ✔ Container dbmanager_server        Created                                                                                    0.1s</span><br><span class="line">Attaching to dbmanager_server, mysql_server</span><br><span class="line">mysql_server      | 2024-01-27 14:17:26+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">mysql_server      | 2024-01-27 14:17:26+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class="line">mysql_server      | 2024-01-27 14:17:26+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">mysql_server      | &#x27;/var/lib/mysql/mysql.sock&#x27; -&gt; &#x27;/var/run/mysqld/mysqld.sock&#x27;</span><br><span class="line">mysql_server      | 2024-01-27T14:17:27.000913Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class="line">mysql_server      | 2024-01-27T14:17:29.465711Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.3.0) starting as process 1</span><br><span class="line">mysql_server      | 2024-01-27T14:17:29.600266Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">mysql_server      | 2024-01-27T14:17:30.775812Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">mysql_server      | 2024-01-27T14:17:32.112855Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class="line">mysql_server      | 2024-01-27T14:17:32.112944Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class="line">mysql_server      | 2024-01-27T14:17:32.117128Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location &#x27;/var/run/mysqld&#x27; in the path is accessible to all OS users. Consider choosing a different directory.</span><br><span class="line">mysql_server      | 2024-01-27T14:17:32.180029Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /var/run/mysqld/mysqlx.sock</span><br><span class="line">mysql_server      | 2024-01-27T14:17:32.180109Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: &#x27;8.3.0&#x27;  socket: &#x27;/var/run/mysqld/mysqld.sock&#x27;  port: 3306  MySQL Community Server - GPL.</span><br><span class="line">dbmanager_server  | Traceback (most recent call last):</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py&quot;, line 145, in __init__</span><br><span class="line">dbmanager_server  |     self._dbapi_connection = engine.raw_connection()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py&quot;, line 3293, in raw_connection</span><br><span class="line">dbmanager_server  |     return self.pool.connect()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 452, in connect</span><br><span class="line">dbmanager_server  |     return _ConnectionFairy._checkout(self)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 1269, in _checkout</span><br><span class="line">dbmanager_server  |     fairy = _ConnectionRecord.checkout(pool)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 716, in checkout</span><br><span class="line">dbmanager_server  |     rec = pool._do_get()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/impl.py&quot;, line 169, in _do_get</span><br><span class="line">dbmanager_server  |     with util.safe_reraise():</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/langhelpers.py&quot;, line 146, in __exit__</span><br><span class="line">dbmanager_server  |     raise exc_value.with_traceback(exc_tb)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/impl.py&quot;, line 167, in _do_get</span><br><span class="line">dbmanager_server  |     return self._create_connection()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 393, in _create_connection</span><br><span class="line">dbmanager_server  |     return _ConnectionRecord(self)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 678, in __init__</span><br><span class="line">dbmanager_server  |     self.__connect()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 902, in __connect</span><br><span class="line">dbmanager_server  |     with util.safe_reraise():</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/langhelpers.py&quot;, line 146, in __exit__</span><br><span class="line">dbmanager_server  |     raise exc_value.with_traceback(exc_tb)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 898, in __connect</span><br><span class="line">dbmanager_server  |     self.dbapi_connection = connection = pool._invoke_creator(self)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/create.py&quot;, line 645, in connect</span><br><span class="line">dbmanager_server  |     return dialect.connect(*cargs, **cparams)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/default.py&quot;, line 616, in connect</span><br><span class="line">dbmanager_server  |     return self.loaded_dbapi.connect(*cargs, **cparams)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/MySQLdb/__init__.py&quot;, line 123, in Connect</span><br><span class="line">dbmanager_server  |     return Connection(*args, **kwargs)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/MySQLdb/connections.py&quot;, line 185, in __init__</span><br><span class="line">dbmanager_server  |     super().__init__(*args, **kwargs2)</span><br><span class="line">dbmanager_server  | MySQLdb.OperationalError: (1049, &quot;Unknown database &#x27;mydb&#x27;&quot;)</span><br><span class="line">dbmanager_server  |</span><br><span class="line">dbmanager_server  | The above exception was the direct cause of the following exception:</span><br><span class="line">dbmanager_server  |</span><br><span class="line">dbmanager_server  | Traceback (most recent call last):</span><br><span class="line">dbmanager_server  |   File &quot;/opt/app.py&quot;, line 11, in &lt;module&gt;</span><br><span class="line">dbmanager_server  |     with engine.connect() as conn:</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py&quot;, line 3269, in connect</span><br><span class="line">dbmanager_server  |     return self._connection_cls(self)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py&quot;, line 147, in __init__</span><br><span class="line">dbmanager_server  |     Connection._handle_dbapi_exception_noconnection(</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py&quot;, line 2431, in _handle_dbapi_exception_noconnection</span><br><span class="line">dbmanager_server  |     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py&quot;, line 145, in __init__</span><br><span class="line">dbmanager_server  |     self._dbapi_connection = engine.raw_connection()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/base.py&quot;, line 3293, in raw_connection</span><br><span class="line">dbmanager_server  |     return self.pool.connect()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 452, in connect</span><br><span class="line">dbmanager_server  |     return _ConnectionFairy._checkout(self)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 1269, in _checkout</span><br><span class="line">dbmanager_server  |     fairy = _ConnectionRecord.checkout(pool)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 716, in checkout</span><br><span class="line">dbmanager_server  |     rec = pool._do_get()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/impl.py&quot;, line 169, in _do_get</span><br><span class="line">dbmanager_server  |     with util.safe_reraise():</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/langhelpers.py&quot;, line 146, in __exit__</span><br><span class="line">dbmanager_server  |     raise exc_value.with_traceback(exc_tb)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/impl.py&quot;, line 167, in _do_get</span><br><span class="line">dbmanager_server  |     return self._create_connection()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 393, in _create_connection</span><br><span class="line">dbmanager_server  |     return _ConnectionRecord(self)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 678, in __init__</span><br><span class="line">dbmanager_server  |     self.__connect()</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 902, in __connect</span><br><span class="line">dbmanager_server  |     with util.safe_reraise():</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/util/langhelpers.py&quot;, line 146, in __exit__</span><br><span class="line">dbmanager_server  |     raise exc_value.with_traceback(exc_tb)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/pool/base.py&quot;, line 898, in __connect</span><br><span class="line">dbmanager_server  |     self.dbapi_connection = connection = pool._invoke_creator(self)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/create.py&quot;, line 645, in connect</span><br><span class="line">dbmanager_server  |     return dialect.connect(*cargs, **cparams)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/sqlalchemy/engine/default.py&quot;, line 616, in connect</span><br><span class="line">dbmanager_server  |     return self.loaded_dbapi.connect(*cargs, **cparams)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/MySQLdb/__init__.py&quot;, line 123, in Connect</span><br><span class="line">dbmanager_server  |     return Connection(*args, **kwargs)</span><br><span class="line">dbmanager_server  |   File &quot;/usr/local/lib/python3.10/dist-packages/MySQLdb/connections.py&quot;, line 185, in __init__</span><br><span class="line">dbmanager_server  |     super().__init__(*args, **kwargs2)</span><br><span class="line">dbmanager_server  | sqlalchemy.exc.OperationalError: (MySQLdb.OperationalError) (1049, &quot;Unknown database &#x27;mydb&#x27;&quot;)</span><br><span class="line">dbmanager_server  | (Background on this error at: https://sqlalche.me/e/20/e3q8)</span><br><span class="line">dbmanager_server exited with code 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们不关闭这个，重新开一个终端</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/dockerProject/docker_dbmanager# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS                     PORTS                 NAMES</span><br><span class="line">0d96a20ca121   dbmanager   &quot;python3 app.py&quot;         7 minutes ago   Exited (1) 6 minutes ago                         dbmanager_server</span><br><span class="line">da8ce1fc7a59   mysql       &quot;docker-entrypoint.s…&quot;   7 minutes ago   Up 7 minutes (healthy)     3306/tcp, 33060/tcp   mysql_server</span><br><span class="line">root@ubuntu-server:~/dockerProject/docker_dbmanager# docker inspect da8ce1fc7a59 | grep &quot;IPAddress&quot;</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.20.0.2&quot;,</span><br><span class="line">root@ubuntu-server:~/dockerProject/docker_dbmanager# mysql -h 172.20.0.2 -u root -p123456</span><br><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 23</span><br><span class="line">Server version: 8.3.0 MySQL Community Server - GPL</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2023, Oracle and/or its affiliates.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show databases;</span></span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| db_in_opt          |</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| wordpressdb        |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.06 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">create database mydb;</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">mysql&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后重新执行一次拉起操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/dockerProject/docker_dbmanager# docker compose up --build</span><br><span class="line">[+] Building 0.1s (14/14) FINISHED                                                                                    docker:default</span><br><span class="line"> =&gt; [dbmanager_server internal] load build definition from Dockerfile                                                           0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 492B                                                                                            0.0s</span><br><span class="line"> =&gt; [dbmanager_server internal] load metadata for docker.io/library/ubuntu:latest                                               0.0s</span><br><span class="line"> =&gt; [dbmanager_server internal] load .dockerignore                                                                              0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                                 0.0s</span><br><span class="line"> =&gt; [dbmanager_server 1/9] FROM docker.io/library/ubuntu:latest                                                                 0.0s</span><br><span class="line"> =&gt; [dbmanager_server internal] load build context                                                                              0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 28B                                                                                                0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 2/9] RUN apt update                                                                                0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 3/9] RUN apt-get install -y python3 python3-pip                                                    0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 4/9] RUN apt-get install -y pkg-config                                                             0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 5/9] RUN apt-get install -y default-libmysqlclient-dev                                             0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 6/9] RUN pip3 install -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com  0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 7/9] RUN pip3 install -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com  0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 8/9] COPY app.py /opt/app.py                                                                       0.0s</span><br><span class="line"> =&gt; CACHED [dbmanager_server 9/9] WORKDIR /opt/                                                                                 0.0s</span><br><span class="line"> =&gt; [dbmanager_server] exporting to image                                                                                       0.0s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                                         0.0s</span><br><span class="line"> =&gt; =&gt; writing image sha256:8cea6473ccddbca8135c6c55eab4151d8414a019820618b97c02d468d2487062                                    0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/dbmanager                                                                                    0.0s</span><br><span class="line">[+] Running 2/2</span><br><span class="line"> ✔ Container mysql_server      Created                                                                                          0.1s</span><br><span class="line"> ✔ Container dbmanager_server  Created                                                                                          0.1s</span><br><span class="line">Attaching to dbmanager_server, mysql_server</span><br><span class="line">mysql_server      | 2024-01-27 14:30:00+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">mysql_server      | 2024-01-27 14:30:00+00:00 [Note] [Entrypoint]: Switching to dedicated user &#x27;mysql&#x27;</span><br><span class="line">mysql_server      | 2024-01-27 14:30:00+00:00 [Note] [Entrypoint]: Entrypoint script for MySQL Server 8.3.0-1.el8 started.</span><br><span class="line">mysql_server      | &#x27;/var/lib/mysql/mysql.sock&#x27; -&gt; &#x27;/var/run/mysqld/mysqld.sock&#x27;</span><br><span class="line">mysql_server      | 2024-01-27T14:30:00.772229Z 0 [System] [MY-015015] [Server] MySQL Server - start.</span><br><span class="line">mysql_server      | 2024-01-27T14:30:01.134172Z 0 [System] [MY-010116] [Server] /usr/sbin/mysqld (mysqld 8.3.0) starting as process 1</span><br><span class="line">mysql_server      | 2024-01-27T14:30:01.143974Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.</span><br><span class="line">mysql_server      | 2024-01-27T14:30:01.392854Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.</span><br><span class="line">mysql_server      | 2024-01-27T14:30:01.675451Z 0 [Warning] [MY-010068] [Server] CA certificate ca.pem is self signed.</span><br><span class="line">mysql_server      | 2024-01-27T14:30:01.676409Z 0 [System] [MY-013602] [Server] Channel mysql_main configured to support TLS. Encrypted connections are now supported for this channel.</span><br><span class="line">mysql_server      | 2024-01-27T14:30:01.679979Z 0 [Warning] [MY-011810] [Server] Insecure configuration for --pid-file: Location &#x27;/var/run/mysqld&#x27; in the path is accessible to all OS users. Consider choosing a different directory.</span><br><span class="line">mysql_server      | 2024-01-27T14:30:01.716925Z 0 [System] [MY-010931] [Server] /usr/sbin/mysqld: ready for connections. Version: &#x27;8.3.0&#x27;  socket: &#x27;/var/run/mysqld/mysqld.sock&#x27;  port: 3306  MySQL Community Server - GPL.</span><br><span class="line">mysql_server      | 2024-01-27T14:30:01.716968Z 0 [System] [MY-011323] [Server] X Plugin ready for connections. Bind-address: &#x27;::&#x27; port: 33060, socket: /var/run/mysqld/mysqlx.sock</span><br><span class="line">dbmanager_server  | MySQL version:</span><br><span class="line">dbmanager_server  | (&#x27;8.3.0&#x27;,)</span><br><span class="line">dbmanager_server exited with code 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/38881094/1706365857717-d9367d1e-8dd1-42cf-bbc9-b652c89e13a2.png"></p>
<p>最后可以停掉这个多容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu-server:~/dockerProject/docker_dbmanager# docker compose down</span><br><span class="line">[+] Running 3/3</span><br><span class="line"> ✔ Container dbmanager_server        Removed                                                                                    0.0s</span><br><span class="line"> ✔ Container mysql_server            Removed                                                                                    1.4s</span><br><span class="line"> ✔ Network docker_dbmanager_default  Removed                                                                                    0.2s</span><br><span class="line">root@ubuntu-server:~/dockerProject/docker_dbmanager# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">root@ubuntu-server:~/dockerProject/docker_dbmanager#</span><br></pre></td></tr></table></figure>

<h1 id="Docker-Image-相关命令速查"><a href="#Docker-Image-相关命令速查" class="headerlink" title="Docker Image 相关命令速查"></a>Docker Image 相关命令速查</h1><ul>
<li><code>docker search [镜像名称]</code> 查找镜像信息</li>
<li><code>docker pull [镜像名称]</code> 拉取镜像</li>
<li><code>docker image ls</code> <code>docker images</code> 查看镜像列表</li>
<li><code>docker rmi [镜像名称/镜像ID]</code> 删除镜像</li>
<li><code>docker save -o [输出文件名] [镜像名称/镜像ID]</code> 将镜像保存为文件，便于传输镜像</li>
<li><code>docker save --output [输出文件名] [镜像名称/镜像ID]</code></li>
<li><code>docker save [镜像名称/镜像ID] &gt; [输出文件名]</code></li>
<li><code>docker load -i [镜像文件]</code> 将文件加载为镜像 Image</li>
<li><code>docker load --input [镜像文件]</code></li>
<li><code>docker load &lt; [镜像文件]</code></li>
<li><code>docker build . -t [构建的镜像名称]</code> 自定义镜像 默认找当前目录下 Dockerfile</li>
<li><code>docker build -f [Dockerfile文件名] -t [构建的镜像名称] [Dockerfile所在目录]</code></li>
</ul>
<h1 id="Docker-Container-相关命令速查"><a href="#Docker-Container-相关命令速查" class="headerlink" title="Docker Container 相关命令速查"></a>Docker Container 相关命令速查</h1><ul>
<li><code>docker run</code><ul>
<li><code>--pull [missing/never/always]</code><ul>
<li>missing 每次运行时候如果没有镜像就拉去 如果有就不拉取 默认也就是 missing 模式</li>
<li>never 每次运行的时候都不去拉取镜像</li>
<li>always 每次运行的时候都去拉取一次镜像</li>
</ul>
</li>
<li><code>-i</code> 以交互的方式运行</li>
<li><code>-t</code> 输出到控制台</li>
<li><code>-it</code> 经常这样用</li>
<li><code>-rm</code> 容器停止以后直接删除</li>
<li><code>-v [主机路径]:[容器内部路径]</code> 做目录映射的，MySQL 常用避免容器删除后数据清空了</li>
<li><code>-p [主机端口]:[容器端口]</code> 端口映射，通过主机的端口来访问容器端口的服务</li>
<li><code>-e(--env) [环境变量]</code> 配置环境变量，如 MySQL 的登录名、端口、密码等</li>
<li><code>--env-file [环境变量定义文件]</code> 配置环境变量定义文件</li>
<li><code>--network [加入的网络名称] --network-alias [容器在网络中的别名]</code> 网络与别名</li>
<li><code>--name [容器名称]</code></li>
<li><code>[镜像名称]</code></li>
<li><code>[命令]</code> 容器启动后的命令</li>
</ul>
</li>
<li><code>docker ps</code> 查看本地运行的容器</li>
<li><code>docker ps -a</code> 查看本地所有的容器</li>
<li><code>docker stop [容器ID]</code> 停止一个正在运行的容器</li>
<li><code>docker start [容器ID]</code> 启动一个已经停止了的容器</li>
<li><code>docker restart [容器ID]</code> 重启一个容器</li>
<li><code>docker kill [容器ID]</code></li>
<li><code>docker rm [容器ID]</code> 删除容器</li>
<li><code>docker attach [容器ID]</code> 重新在控制台显示容器输出的内容 有时候以-d 运行的容器 后续内容不会打印</li>
<li><code>docker history [容器名称]</code> 查看执行该容器的历史命令</li>
<li><code>docker exec -d [容器名称/容器ID] [要执行的命令]</code> 对某个容器执行一条命令，但看不见后续内容</li>
<li><code>docker exec -it [容器名称/容器ID] [要执行的命令(常用bash进入交互)]</code></li>
<li><code>docker export -o [导出的容器文件名称] [容器ID]</code> 导出容器</li>
<li><code>docker import [要导入的容器文件]</code> 导入容器</li>
<li><code>docker cp [源文件] [目标文件]</code> 在主机与容器之间复制文件</li>
</ul>
<blockquote>
<p>更新: 2024-02-01 02:30:01<br>原文: <a target="_blank" rel="noopener" href="https://www.yuque.com/zacharyblock/cx2om6/oxlyrpyvo0ylgtio">https://www.yuque.com/zacharyblock/cx2om6/oxlyrpyvo0ylgtio</a></p>
</blockquote>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Zachary Block</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://blockzachary.github.io/blog/4203719214/">https://blockzachary.github.io/blog/4203719214/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Docker/"># Docker</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/blog/1915393917/">解决“git-Failed to connect to 127.0.0.1 port 7890: 拒绝连接</a>
            
            
            <a class="next" rel="next" href="/blog/4042161217/">Python - 单元测试</a>
            
        </section>


    </article>
</div>

<script src="/js/clipboard.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var codeBlocks = document.querySelectorAll('article .code pre');

        codeBlocks.forEach(function (codeBlock) {
            var copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.innerText = 'Copy';

            // Check if the code block is in the article content
            if (codeBlock.closest('article')) {
                codeBlock.parentNode.style.position = 'relative';
                codeBlock.parentNode.appendChild(copyButton); // 将按钮添加到 codeBlock 的父节点内

                var isCopying = false;

                copyButton.addEventListener('click', function () {
                    if (!isCopying) {
                        var codeText = codeBlock.innerText;
                        navigator.clipboard.writeText(codeText).then(function () {
                            copyButton.innerText = 'Copied!';
                            isCopying = true;
                            setTimeout(function () {
                                copyButton.innerText = 'Copy';
                                isCopying = false;
                            }, 1500);
                        }).catch(function (err) {
                            console.error('Copy failed', err);
                        });
                    }
                });
            }
        });
    });
</script>

<style>
    .copy-button {
        position: absolute;
        top: 0;
        right: 0;
        background-color: #2d96bd;
        color: #fff;
        border: none;
        border-radius: 10%;
        padding: 5px 10px;
        cursor: pointer;
    }
</style>
            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Zachary Block | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>

    <!-- Chic/layout.ejs -->
    <div id="u-search">
        <div class="modal">
            <div class="modal-header">
                <div class="container">
                    <form id="u-search-modal-form" class="u-search-modal-form">
                        <button type="submit" class="form-submit-btn">
                            <img src="/" class="search-btn-img" />
                        </button>
                        <input placeholder="搜索文章。。。" class="form-input" id="modal-form-input">
                    </form>
                    <a class="modal-close">x</a>
                </div>
                <div class="search-loading">
                    <div class="search-loading-bar"></div>
                </div>
            </div>
            <div class="modal-body">
                <!-- ul 格式如下 -->
                <!-- <ul class="modal-results">
                    <li class="result-item">
                        <a class="result-item-detail">
                            <span class="title">页面配置</span>
                            <span class="content">
                                content
                            </span>
                        </a>
                    </li>
                </ul> -->
            </div>
        </div>
        <div class="modal-overlay"></div>
    </div>
</body>

</html>